<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Валентин Соколов, Мария Фоканова и другие.">
<title>Руководство по сборке RPM-пакетов для дистрибутивов Альт</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Руководство по сборке RPM-пакетов для дистрибутивов Альт</h1>
<div class="details">
<span id="author" class="author">Валентин Соколов, Мария Фоканова и другие.</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Оглавление</div>
<ul class="sectlevel1">
<li><a href="#introduction">Вступление</a>
<ul class="sectlevel2">
<li><a href="#pdf-version">PDF Версия</a></li>
<li><a href="#document-conventions">Структура документации</a></li>
<li><a href="#_вклад_в_руководство">Вклад в руководство</a></li>
<li><a href="#prerequisites">Установка необходимых пакетов для процесса сборки</a></li>
</ul>
</li>
<li><a href="#Why-Package-Software-with-RPM">Введение в пакетные менеджеры</a>
<ul class="sectlevel2">
<li><a href="#RPM_Commands">Основные команды RPM</a></li>
</ul>
</li>
<li><a href="#what-is-an-rpm">Что такое RPM-пакет?</a>
<ul class="sectlevel2">
<li><a href="#rpm-packaging-tools">Подготовка к сборке RPM-пакетов</a></li>
<li><a href="#rpm-packaging-workspace">Рабочее пространство для сборки RPM-пакетов</a></li>
</ul>
</li>
<li><a href="#hello-gear">Инструмент Gear</a>
<ul class="sectlevel2">
<li><a href="#_вступление">Вступление</a>
<ul class="sectlevel3">
<li><a href="#_структура_репозитория">Структура репозитория</a></li>
<li><a href="#_правила_экспорта">Правила экспорта</a></li>
<li><a href="#_основные_типы_устройства_gear_репозитория">Основные типы устройства gear-репозитория</a></li>
</ul>
</li>
<li><a href="#quick-start-gear">Быстрый старт Gear</a>
<ul class="sectlevel3">
<li><a href="#_создание_gear_репозитория_путём_импорта_созданного_ранее_srpm_пакета">Создание gear-репозитория путём импорта созданного ранее srpm-пакета.</a></li>
<li><a href="#_создание_gear_репозитория_на_основе_готового_git_репозитория">Создание gear-репозитория на основе готового git-репозитория</a></li>
<li><a href="#_сборка_пакета_из_gear_репозитория">Сборка пакета из gear-репозитория</a></li>
<li><a href="#_фиксация_изменений_в_репозитории">Фиксация изменений в репозитории</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#preparing-software-for-packaging">Подготовка программного обеспечения для упаковки</a>
<ul class="sectlevel2">
<li><a href="#what-is-source-code">Что такое Исходный код?</a></li>
<li><a href="#how-programs-are-made">Как создаются программы</a>
<ul class="sectlevel3">
<li><a href="#natively-compiled-code">Изначально скомпилированный код</a></li>
<li><a href="#interpreted-code">Интерпретируемый код</a></li>
</ul>
</li>
<li><a href="#building-software-from-source">Сборка программного обеспечения из исходного кода</a>
<ul class="sectlevel3">
<li><a href="#natively-compiled-code-building-software-from-source">Изначально скомпилированный код</a></li>
<li><a href="#interpreted-code-building-software-from-source">Интерпретируемый код</a></li>
</ul>
</li>
<li><a href="#patching-software">Программное обеспечение для исправления ошибок</a></li>
<li><a href="#installing-arbitrary-artifacts">Установка Произвольных Артефактов</a>
<ul class="sectlevel3">
<li><a href="#install-command">Использование команды install</a></li>
<li><a href="#make-install">Использование команды make install</a></li>
</ul>
</li>
<li><a href="#preparing-source-code-for-packaging">Подготовка исходного кода для упаковки</a></li>
<li><a href="#putting-source-code-into-tarball">Создание Tarball с исходным кодом</a>
<ul class="sectlevel3">
<li><a href="#bello">bello</a></li>
<li><a href="#pello">pello</a></li>
<li><a href="#cello">cello</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#building-rpm">Примеры сборки пакетов с использованием инструментов Альт</a>
<ul class="sectlevel2">
<li><a href="#_подготовка_пространства">Подготовка пространства</a></li>
<li><a href="#_написание_spec_файла_и_правил_gear">Написание spec файла и правил Gear</a></li>
<li><a href="#_описание_пакета_с_исходными_текстами_на_c">Описание пакета с исходными текстами на C++</a></li>
<li><a href="#_программное_обеспечение_для_исправления_ошибок">Программное обеспечение для исправления ошибок</a></li>
<li><a href="#version-control-systems">Система контроля версий</a></li>
</ul>
</li>
<li><a href="#advanced-topics">Дополнительные материалы</a>
<ul class="sectlevel2">
<li><a href="#Signing-Packages">Подпись пакетов</a>
<ul class="sectlevel3">
<li><a href="#Adding-a-Signature-to-a-Package">Добавление подписи к пакету</a></li>
<li><a href="#Replacing-a-Package-Signature">Замена подписи пакета</a></li>
<li><a href="#Build-time-Signing">Подпись во время сборки</a></li>
</ul>
</li>
<li><a href="#more-on-macros">Подробнее о макросах</a>
<ul class="sectlevel3">
<li><a href="#defining-your-own">Определение Ваших Собственных Макросов</a></li>
<li><a href="#setup">%setup</a></li>
<li><a href="#files">%files</a></li>
<li><a href="#built-in-macros">Встроенные макросы</a></li>
<li><a href="#rpm-distribution-macros">RPM Макросы, предоставляемые дистрибутивом</a></li>
</ul>
</li>
<li><a href="#custom-macros">Пользовательские макросы</a></li>
<li><a href="#epoch-scriptlets-and-triggers">Epoch, Скриптлеты и Триггеры</a></li>
</ul>
</li>
<li><a href="#_hasher_start">Hasher start</a>
<ul class="sectlevel2">
<li><a href="#_что_такое_hasher">Что такое hasher?</a></li>
<li><a href="#_принцип_действия">Принцип действия</a></li>
<li><a href="#_настройка_hasher">Настройка Hasher</a></li>
<li><a href="#_сборка_в_hasher">Сборка в hasher</a></li>
<li><a href="#_сборочные_зависимости">Сборочные зависимости</a></li>
<li><a href="#_man_hasher">man hasher</a></li>
<li><a href="#_монтирование_файловых_систем_внутри_hasher">Монтирование файловых систем внутри hasher</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction">Вступление</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Уважаемый читатель!</p>
</div>
<div class="paragraph">
<p>Мы хотим обратить Ваше внимание на то, что для успешного прохождения руководства необходимо внимательно читать текст и уделять внимание деталям. Каждый раздел содержит информацию, которая поможет Вам понять процесс сборки пакетов и улучшить свои навыки в этой области.</p>
</div>
<div class="paragraph">
<p>В тексте документации присутствуют ссылки на дополнительную информацию. Мы настоятельно рекомендуем Вам переходить по этим ссылкам и ознакомляться с материалами более подробно. Это поможет Вам лучше понимать темы, раскрытые в руководстве, и получить полезную дополнительную информацию.</p>
</div>
<div class="sect2">
<h3 id="pdf-version">PDF Версия</h3>
<div class="paragraph">
<p>Вы также можете скачать
<a href="https://alt-packaging-guide.github.io/alt-packaging-guide.pdf">PDF версию
данного документа</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="document-conventions">Структура документации</h3>
<div class="paragraph">
<p>Перед тем, как приступить к сборке, нужно создать структуру каталогов, необходимую RPM, находящуюся в Вашем «домашнем» каталоге:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Отображение файловой структуры будет представлено следующим образом:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ tree ~/RPM/
/home/user/RPM/
|-- BUILD
|-- BUILDROOT
|-- RPMS
|   |-- i586
|   |-- x86_64
|   `-- noarch
|-- SOURCES
|-- SPECS
`-- SRPMS</code></pre>
</div>
</div>
</li>
<li>
<p>В дальнейшем вывод команд будет продемонстрирован следующим образом:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="txt">Name:           bello
Version:
Release:        alt1
Summary:</code></pre>
</div>
</div>
</li>
<li>
<p>Темы, представляющие интерес, или словарные термины упоминаются либо как ссылки на соответствующую документацию или веб-сайт выделены <strong>жирным</strong> шрифтом, либо <em>курсивом</em>. Первые упоминания некоторых терминов ссылаются на соответствующую документацию.</p>
</li>
<li>
<p>Названия утилит, команд и других элементов, обычно встречающихся в коде, написаны <code>моноширинным</code> шрифтом.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
Для сокращения команд, встречающихся в тексте, будет использоваться нотация:
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>- команды без административных привилегий будут начинаться с символа &#8220;$&#8221;</p>
</li>
<li>
<p>- команды с административными привилегиями будут начинаться с символа &#8220;#&#8221;</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
По умолчанию <code>sudo</code> может быть отключено. Для получения административных привилегий используется команда <code>su</code>. Для включения <code>sudo</code> в стандартном режиме можно использовать команду:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># control sudowheel enabled</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_вклад_в_руководство">Вклад в руководство</h3>
<div class="paragraph">
<p>Вы можете внести свой вклад в это руководство, отправив запрос на принятие изменений  (Pull Request) в
<a href="https://github.com/altlinux/alt-packaging-guide">репозиторий</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="prerequisites">Установка необходимых пакетов для процесса сборки</h3>
<div class="paragraph">
<p>Чтобы следовать данному руководству, Вам потребуется установить следующие пакеты:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
Некоторые из этих пакетов устанавливаются по умолчанию в
<a href="https://www.altlinux.org/Releases">Альт</a>. Установка проводится с правами суперпользователя.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># apt-get update

Получено: 1 http://ftp.altlinux.org p10/branch/x86_64 release [4223B]
Получено: 2 http://ftp.altlinux.org p10/branch/x86_64-i586 release [1665B]
Получено: 3 http://ftp.altlinux.org p10/branch/noarch release [2844B]
Получено 8732B за 0s (81,8kB/s).
Найдено http://ftp.altlinux.org p10/branch/x86_64/classic pkglist
Найдено http://ftp.altlinux.org p10/branch/x86_64/classic release
Найдено http://ftp.altlinux.org p10/branch/x86_64/gostcrypto pkglist
Найдено http://ftp.altlinux.org p10/branch/x86_64/gostcrypto release
Найдено http://ftp.altlinux.org p10/branch/x86_64-i586/classic pkglist
Найдено http://ftp.altlinux.org p10/branch/x86_64-i586/classic release
Найдено http://ftp.altlinux.org p10/branch/noarch/classic pkglist
Найдено http://ftp.altlinux.org p10/branch/noarch/classic release
Чтение списков пакетов... Завершено
Построение дерева зависимостей... Завершено

# apt-get install gcc rpm-build rpmlint make python gear hasher patch rpmdevtools</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Why-Package-Software-with-RPM">Введение в пакетные менеджеры</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>RPM</strong> — это семейство пакетных менеджеров, применяемых в различных дистрибутивах GNU/Linux, в том числе и в проекте <a href="https://www.altlinux.org/Sisyphus">Сизиф</a> и в дистрибутивах <a href="https://www.altlinux.org/Releases">Альт</a>. Практически каждый крупный проект, использующий RPM, имеет свою версию пакетного менеджера, отличающуюся от остальных.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Различия между представителями семейства RPM выражаются в: </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>наборе макросов, используемых в .spec-файлах,</p>
</li>
<li>
<p>различном поведении RPM при сборке «по умолчанию» — при отсутствии каких-либо указаний в .spec-файлах,</p>
</li>
<li>
<p>формате строк зависимостей,</p>
</li>
<li>
<p>мелких отличиях в семантике операций (например, в операциях сравнения версий пакетов),</p>
</li>
<li>
<p>мелких отличиях в формате файлов.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Для пользователя различия чаще всего заключаются в невозможности поставить «неродной» пакет из-за проблем с зависимостями или из-за формата пакета.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">RPM в проекте Сизиф также не является исключением. Основные отличия RPM в Альт и Сизиф от RPM других крупных проектов заключаются в следующем: </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>обширный набор макросов для сборки различных типов пакетов,</p>
</li>
<li>
<p>отличающееся поведение «по умолчанию» для уменьшения количества шаблонного кода в .spec-файлах,</p>
</li>
<li>
<p>наличие механизмов для автоматического поиска межпакетных зависимостей,</p>
</li>
<li>
<p>наличие так называемых set-version зависимостей (начиная с <code>4.0.4-alt98.46</code> ), обеспечивающих дополнительный контроль за изменением ABI библиотек,</p>
</li>
<li>
<p>до <code>p8</code> и выпусков <code>8.x</code> включительно&#8201;&#8212;&#8201;очень древняя версия «базового» RPM (4.0.4), от которого началось развитие ветки RPM в Sisyphus (в Sisyphus и <code>p9</code> осуществлён частичный переход на <code>rpm 4.13</code>).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="RPM_Commands">Основные команды RPM</h3>
<div class="paragraph">
<p>Для ознакомления с данным разделом потребуется пакет. В качестве примера мы будем использовать пакет <a href="http://ftp.altlinux.org/pub/distributions/ALTLinux/p10/branch/noarch/RPMS.classic/yodl-docs-4.03.00-alt2.noarch.rpm">Yodl-docs</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Как узнать информацию о RPM-пакете без установки?</dt>
<dd>
<p>После скачивания пакета можно посмотреть данные о нём перед установкой. Для этого используется <strong>-qip</strong>, (Query|Install|Package)чтобы вывести информацию о пакете.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
ключ <code>-p</code> (-package) работает не с базой RPM-пакетов, а с конкретным пакетом. Например: чтобы получить информацию о файлах, находящихся в пакете, который не установлен в систему, используют ключи <code>-qpl</code>(Query|Package|List).
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm -qip yodl-docs-4.03.00-alt2.noarch.rpm</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вывод:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">Name        : yodl-docs
Epoch       : 1
Version     : 4.03.00
Release     : alt2
DistTag     : sisyphus+271589.100.1.2
Architecture: noarch
Install Date: (not installed)
Group       : Documentation
Size        : 3701571
License     : GPL
Signature   : DSA/SHA1, Чт 13 мая 2021 05:44:49, Key ID 95c584d5ae4ae412
Source RPM  : yodl-4.03.00-alt2.src.rpm
Build Date  : Чт 13 мая 2021 05:44:44
Build Host  : darktemplar-sisyphus.hasher.altlinux.org
Relocations : (not relocatable)
Packager    : Aleksei Nikiforov &lt;darktemplar@altlinux.org&gt;
Vendor      : ALT Linux Team
URL         : https://gitlab.com/fbb-git/yodl
Summary     : Documentation for Yodl
Description :
Yodl is a package that implements a pre-document language and tools to
process it.  The idea of Yodl is that you write up a document in a
pre-language, then use the tools (eg. yodl2html) to convert it to some
final document language.  Current converters are for HTML, ms, man, LaTeX
SGML and texinfo, plus a poor-man's text converter.  Main document types
are "article", "report", "book" and "manpage".  The Yodl document
language is designed to be easy to use and extensible.

This package contais documentation for Yodl.</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Как установить RPM-пакет?</dt>
<dd>
<p>Для установки используется параметр <strong>-ivh</strong> (Install|Verbose|Hash).</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
Ключи -v и -h не влияют на установку, а служат для вывода наглядного процесса сборки в консоль. Ключ -v (verbose) выводит детальные значения. Ключ -h (hash) выводит "#" по мере установки пакета.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm -ivh yodl-docs-4.03.00-alt2.noarch.rpm</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вывод:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">Подготовка...                ############################################################ [100%]
Обновление / установка...
1: yodl-docs-1:4.03.00-alt2  ############################################################ [100%]
Running /usr/lib/rpm/posttrans-filetriggers</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Проверка установки пакета в системе.</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm -q () yodl-docs</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вывод:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">yodl-docs-4.03.00-alt2.noarch</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Просмотр файлов пакета, установленного в системе.</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm -ql yodl-docs</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вывод:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/usr/share/doc/yodl
/usr/share/doc/yodl-doc
/usr/share/doc/yodl-doc/AUTHORS.txt
/usr/share/doc/yodl-doc/CHANGES
/usr/share/doc/yodl-doc/changelog
/usr/share/doc/yodl-doc/yodl.dvi
/usr/share/doc/yodl-doc/yodl.html
/usr/share/doc/yodl-doc/yodl.latex
/usr/share/doc/yodl-doc/yodl.pdf
/usr/share/doc/yodl-doc/yodl.ps
/usr/share/doc/yodl-doc/yodl.txt
/usr/share/doc/yodl-doc/yodl01.html
/usr/share/doc/yodl-doc/yodl02.html
/usr/share/doc/yodl-doc/yodl03.html
/usr/share/doc/yodl-doc/yodl04.html
/usr/share/doc/yodl-doc/yodl05.html
/usr/share/doc/yodl-doc/yodl06.html
/usr/share/doc/yodl/AUTHORS.txt
/usr/share/doc/yodl/CHANGES
/usr/share/doc/yodl/changelog</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Просмотр недавно установленных пакетов.</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">rpm -qa --last|head</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вывод:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">yodl-docs-4.03.00-alt2.noarch                 Чт 22 дек 2022 18:09:10
source-highlight-3.1.9-alt1.git.904949c.x86_64 Вт 20 дек 2022 18:38:29
libsource-highlight-3.1.9-alt1.git.904949c.x86_64 Вт 20 дек 2022 18:38:29
gem-asciidoctor-doc-2.0.10-alt1.noarch        Вт 20 дек 2022 18:34:04
w3m-0.5.3-alt4.git20200502.x86_64             Вт 20 дек 2022 18:23:05
sgml-common-0.6.3-alt15.noarch                Вт 20 дек 2022 18:23:05
libmaa-1.4.7-alt4.x86_64                      Вт 20 дек 2022 18:23:05
docbook-style-xsl-1.79.1-alt4.noarch          Вт 20 дек 2022 18:23:05
docbook-dtds-4.5-alt1.noarch                  Вт 20 дек 2022 18:23:05
dict-1.12.1-alt4.1.x86_64                     Вт 20 дек 2022 18:23:05</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Поиск пакета в системе.</dt>
<dd>
<p>Команда <strong>grep</strong> поможет определить, установлен пакет в системе или нет:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm -qa | grep yodl-docs</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вывод:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">yodl-docs-4.03.00-alt2.noarch</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Проверка файла, относящегося к пакету.</dt>
<dd>
<p>Предположим, что нужно узнать, к какому конкретному пакету относится файл. Для этого используют команду:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm -qf /usr/share/doc/yodl-doc</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вывод:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">yodl-docs-4.03.00-alt2.noarch</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Вывод информации о пакете.</dt>
<dd>
<p>Чтобы получить информацию о пакете, установленном в систему, используем команду:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm -qi yodl-docs</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вывод:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">Name        : yodl-docs
Epoch       : 1
Version     : 4.03.00
Release     : alt2
DistTag     : sisyphus+271589.100.1.2
Architecture: noarch
Install Date: Чт 22 дек 2022 18:09:10
Group       : Documentation
Size        : 3701571
License     : GPL
Signature   : DSA/SHA1, Чт 13 мая 2021 05:44:49, Key ID 95c584d5ae4ae412
Source RPM  : yodl-4.03.00-alt2.src.rpm
Build Date  : Чт 13 мая 2021 05:44:44
Build Host  : darktemplar-sisyphus.hasher.altlinux.org
Relocations : (not relocatable)
Packager    : Aleksei Nikiforov &lt;darktemplar@altlinux.org&gt;
Vendor      : ALT Linux Team
URL         : https://gitlab.com/fbb-git/yodl
Summary     : Documentation for Yodl
Description :
Yodl is a package that implements a pre-document language and tools to
process it.  The idea of Yodl is that you write up a document in a
pre-language, then use the tools (eg. yodl2html) to convert it to some
final document language.  Current converters are for HTML, ms, man, LaTeX
SGML and texinfo, plus a poor-man's text converter.  Main document types
are "article", "report", "book" and "manpage".  The Yodl document
language is designed to be easy to use and extensible.</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Обновление пакета.</dt>
<dd>
<p>Для обновления пакета используется параметр <strong>-Uvh</strong>.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm -Uvh yodl-docs-4.03.00-alt2.noarch.rpm</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вывод:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"> Подготовка...             ############################################################ [100%]
	пакет yodl-docs-1:4.03.00-alt2.noarch уже установлен</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
Справку по ключам можно получить, набрав в консоли команду <code>rpm --help</code>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-is-an-rpm">Что такое RPM-пакет?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>RPM-пакет - это архив, содержащий в себе архив <a href="https://en.wikipedia.org/wiki/Cpio">.cpio</a> с файлами, а также метаданные - имя пакета, его описание, зависимости и т.д.</p>
</div>
<div class="paragraph">
<p>Существует два типа RPM-пакетов:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SRPM-пакеты (исходники) - архив с расширением <code>.src.rpm</code></p>
</li>
<li>
<p>RPM-пакеты - архив с расширением <code>.rpm</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>SRPM и RPM-пакеты имеют общий формат, но имеют разное содержимое и служат разным целям. SRPM содержит исходный код, при необходимости патчи к нему и spec-файл, в котором описывается, как собрать исходный код в RPM-пакет.</p>
</div>
<div class="paragraph">
<p>RPM-пакет содержит исполняемые файлы, созданные из исходного кода и патчей, если таковые имелись, библиотеки и метаданные. Менеджер пакетов RPM использует эти метаданные для проверки наличия необходимых пакетов из списка зависимостей, исполнения инструкций по установке файлов и сохранения общей информации о пакете у себя в базе.</p>
</div>
<div class="sect2">
<h3 id="rpm-packaging-tools">Подготовка к сборке RPM-пакетов</h3>
<div class="paragraph">
<p>Пакет <code>rpmdevtools</code>, установленный на этапе <a href="#prerequisites">Необходимые пакеты</a>, предоставляет несколько утилит, упрощающие подготовку к сборке RPM-пакетов. Чтобы перечислить эти утилиты, выполните в консоли следующую команду:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm -ql rpmdevtools | grep bin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Для получения дополнительной информации о вышеуказанных утилитах см. их страницы руководства или диалоговые окна справки.</p>
</div>
</div>
<div class="sect2">
<h3 id="rpm-packaging-workspace">Рабочее пространство для сборки RPM-пакетов</h3>
<div class="paragraph">
<p>Чтобы создать дерево каталогов, которое является рабочей областью сборки RPM-пакетов, используйте утилиту <code>rpmdev-setuptree</code>, или же создайте каталоги вручную, используя утилиту <code>mkdir</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmdev-setuptree

$ tree ~/rpmbuild/
/home/user/rpmbuild/
|-- BUILD
|-- RPMS
|-- SOURCES
|-- SPECS
 -- SRPMS</code></pre>
</div>
</div>
<div class="paragraph">
<p>Описание созданных каталогов:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Каталог</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Назначение</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BUILD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Содержит все файлы, которые появляются при сборке пакета.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RPMS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Здесь появляются готовые RPM-пакеты (<code>.rpm</code>) в подкаталогах для разных архитектур, например, в подкаталогах<code>x86_64</code> и <code>noarch</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SOURCES</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Здесь находятся архивы исходного кода и патчи. Утилита <code>rpmbuild</code> ищет их здесь.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPECS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Здесь хранятся spec-файлы.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SRPMS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Здесь находятся пакеты с исходниками (<code>.src.rpm</code>).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>После создания дерева каталогов перейдём в файл <code>~/home/.rpmmacros</code>. В нём содержится следующая информация:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Месторасположение структуры каталогов для сборки;</p>
</li>
<li>
<p>Ключ для подписи пакетов;</p>
</li>
<li>
<p>Значение поля <em>Packager</em></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">%_topdir&lt;------&gt;%homedir/RPM
#%_tmppath&lt;----&gt;%homedir/tmp

# %packager&lt;---&gt;Joe Hacker &lt;joe@email.address&gt;
# %_gpg_name&lt;--&gt;joe@email.address</code></pre>
</div>
</div>
<div class="paragraph">
<p>Раскомментируйте поле <em>Packager</em>: Впишите своё имя, фамилию и почту. Поле с ключём для подписи Вы заполните позже. О том, как создавать ключи, Вы узнаете в разделе <a href="#JoinKey">Создание SSH и GPG ключей</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
Действия, описанные ниже, необходимы для корректного прохождения документации, они обязательны к выполнению!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Итак, если Вы воспользовались утилитой <code>rpmdev-setuptree</code>, а не создали дерево каталогов вручную, обрате внимание на файл <code>~/home/.rpmmacros</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">%_topdir&lt;------&gt;%homedir/RPM
#%_tmppath&lt;----&gt;%homedir/tmp

%packager&lt;---&gt;Joe Hacker &lt;joe@email.address&gt;
# %_gpg_name&lt;--&gt;joe@email.address

%__arch_install_post \
    [ "%{buildarch}" = "noarch" ] || QA_CHECK_RPATHS=1 ; \
    case "${QA_CHECK_RPATHS:-}" in [1yY]*) /usr/lib/rpm/check-rpaths ;; esac \
    /usr/lib/rpm/check-buildroot</code></pre>
</div>
</div>
<div class="paragraph">
<p>В файле появилась секция <code>%__arch_install_post</code>. Данную секцию необходимо удалить, вернув файл к исходному состоянию, иначе процесс сборки будет завершаться с ошибкой.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">%_topdir&lt;------&gt;%homedir/RPM
#%_tmppath&lt;----&gt;%homedir/tmp

%packager&lt;---&gt;Valentin Sokolov &lt;sova@altlinux.org&gt;
# %_gpg_name&lt;--&gt;joe@email.address</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hello-gear">Инструмент Gear</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_вступление">Вступление</h3>
<div class="paragraph">
<p>Gear (Get Every Archive from git package Repository) - система для работы с произвольными архивами программ. В качестве хранилища данных gear использует <code>git</code>, что позволяет работать с полной историей проекта.</p>
</div>
<div class="paragraph">
<p>Основной смысл хранения исходного кода пакетов в <code>git-репозитории</code> заключается в более эффективной и удобной совместной разработке, а также в минимизации используемого дискового пространства для хранения архива репозитория за длительный срок и минимизации трафика при обновлении исходного кода.</p>
</div>
<div class="paragraph">
<p>Идея gear заключается в том, чтобы с помощью одного файла с простыми правилами (для обработки которых достаточно sed и git) можно было бы собирать пакеты из произвольно устроенного git-репозитория, по аналогии с hasher, который был задуман как средство для сборки пакетов из произвольных 'srpm-пакетов'.</p>
</div>
<div class="sect3">
<h4 id="_структура_репозитория">Структура репозитория</h4>
<div class="paragraph">
<p>Хотя <code>gear</code> и не накладывает ограничений на внутреннюю организацию git-репозитория (не считая требования наличия файла с правилами), есть несколько соображений о том, как более эффективно и удобно организовывать git-репозитории, предназначенные для хранения исходного кода пакетов.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Одна сущность — один репозиторий</dt>
<dd>
<p>Не стоит помещать в один репозиторий несколько разных пакетов, за исключением случаев, когда у этих пакетов есть общий пакет-предок.</p>
<div class="ulist">
<ul>
<li>
<p>Плюсы: Соблюдение этого правила облегчает совместную работу над пакетом, поскольку неперегруженный репозиторий легче клонировать и в целом инструментарий git больше подходит для работы с такими репозиториями.</p>
</li>
<li>
<p>Минусы: Несколько сложнее выполнять операции <strong>fetch</strong> и <strong>push</strong> в случае, когда репозиториев, которые надо обработать, много. Впрочем, <strong>fetch/push</strong> в цикле выручает.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Несжатый исходный код</dt>
<dd>
<p>Сжатый разными средствами (<code>gzip</code>, <code>bzip2</code> и т.п.) исходный код лучше хранить в git-репозитории в несжатом виде.</p>
<div class="ulist">
<ul>
<li>
<p>Плюсы: Изменение файлов, которые помещены в репозиторий в сжатом виде, менее удобно отслеживать штатными средствами (<strong>git diff</strong>). Поскольку git хранит объекты в сжатом виде, двойное сжатие редко приводит к экономии дискового пространства. Наконец, алгоритм, применяемый для минимизации трафика при обновлении репозитория по протоколу git, более эффективен на несжатых данных.</p>
</li>
<li>
<p>Минусы: Поскольку некоторые виды сжатия одних и тех же данных могут приводить к разным результатам, может уменьшиться степень первозданности (нативности) исходного кода.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Распакованный исходный код</dt>
<dd>
<p>Исходный код, запакованный архиваторами (<code>tar</code>, <code>cpio</code>, <code>zip</code> и т.п.), лучше хранить в <code>git</code>-репозитории в распакованном виде.</p>
<div class="ulist">
<ul>
<li>
<p>Плюсы: Существенно удобнее вносить изменения в конечные файлы и отслеживать изменения в них, заметно меньше трафик при обновлении.</p>
</li>
<li>
<p>Минусы: Поскольку <code>git</code> из информации о владельце, правах доступа и дате модификации файлов хранит только исполняемость файлов, любой архив, созданный из репозитория, будет по этим параметрам отличаться от первозданного. Помимо потери нативности, изменение прав доступа и даты модификации может теоретически повлиять на результат сборки пакета. Впрочем, сборку таких пакетов, если они будут обнаружены, всё равно придётся исправить.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Форматированный changelog</dt>
<dd>
<p>В changelog релизного <code>commit&#8217;а</code> имеет смысл включать соответствующий текст из <code>changelog&#8217;а</code> пакета, как это делают утилиты <code>gear-commit</code> (обёртка к <code>git commit</code>, специально предназначенная для этих целей) и <code>gear-srpmimport</code>. В результате можно будет получить представление об изменениях в очередном релизе пакета, не заглядывая в spec-файл самого пакета.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_правила_экспорта">Правила экспорта</h4>
<div class="paragraph">
<p>С одной стороны, для того, чтобы srpm-пакет мог быть импортирован в git-репозиторий наиболее удобным для пользователя способом, язык правил, согласно которым производится экспорт из коммита репозитория (в форму, из которой можно однозначно изготовить srpm-пакет или запустить сборку), должен быть достаточно выразительным.</p>
</div>
<div class="paragraph">
<p>С другой стороны, для того, чтобы можно было относительно безбоязненно собирать пакеты из чужих gear-репозиториев, этот язык правил должен быть достаточно простым.</p>
</div>
<div class="paragraph">
<p>Файл правил экспорта (по умолчанию в <code>.gear/rules</code>) состоит из строк формата:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="txt">директива: параметры</code></pre>
</div>
</div>
<div class="paragraph">
<p>Параметры разделяются пробельными символами.</p>
</div>
<div class="paragraph">
<p>Директивы позволяют экспортировать:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Любой файл из дерева, соответствующего коммиту;</p>
</li>
<li>
<p>Любой каталог из дерева, соответствующего коммиту в виде <code>tar-</code> или <code>zip-архива</code>;</p>
</li>
<li>
<p><code>nified diff</code> между любыми каталогами, соответствующими коммитам.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Файлы на выходе могут быть сжаты разными средствами (<code>gzip</code>, <code>bzip2</code> и т.п.). В качестве коммита может быть указан как целевой коммит (значение параметра -t утилиты gear), так и любой из его предков при соблюдении условий, гарантирующих однозначное вычисление полного имени коммита-предка по целевому коммиту.</p>
</div>
<div class="paragraph">
<p>(Правила экспорта из gear-репозитория описаны детально в <code>gear-rules</code>.)(ссылка под редактуру)</p>
</div>
</div>
<div class="sect3">
<h4 id="_основные_типы_устройства_gear_репозитория">Основные типы устройства gear-репозитория</h4>
<div class="paragraph">
<p>Правила экспорта реализуют основные типы устройства gear-репозитория следующим образом:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Архив с модифицированным исходным кодом</dt>
<dd>
<p>С помощью простого правила</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">tar: .</code></pre>
</div>
</div>
<div class="paragraph">
<p>Всё дерево исходного кода экспортируется в один tar-архив. Если у проекта есть upstream, публикующий tar-архивы, то добавление релиза в имя tar-архива, например, с помощью правила:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">tar: . name=@name@-@version@-@release@</code></pre>
</div>
</div>
<div class="paragraph">
<p>позволяет избежать коллизий.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Архив с немодифицированным исходным кодом и патчем, содержащем локальные изменения</dt>
<dd>
<p>Если дерево с немодифицированным исходным кодом хранится в отдельном подкаталоге, а локальные изменения хранятся в gear-репозитории в виде отдельных патч-файлов, то правила экспорта могут выглядеть следующим образом:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">tar: package_name
copy: *.patch</code></pre>
</div>
</div>
<div class="paragraph">
<p>Такое устройство репозитория получается при использовании утилиты <code>gear-srpmimport</code>, предназначенной для быстрой миграции от srpm-файла к <code>gear</code>-репозиторию.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Смешанные типы</dt>
<dd>
<p>Вышеперечисленные типы устройства gear-репозитория являются основными, но не исчерпывающими. Правила экспорта достаточно выразительны для того, чтобы реализовать всевозможные сочетания основных типов и создать полнофункциональный gear-репозиторий на любой вкус.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="quick-start-gear">Быстрый старт Gear</h3>
<div class="sect3">
<h4 id="_создание_gear_репозитория_путём_импорта_созданного_ранее_srpm_пакета">Создание gear-репозитория путём импорта созданного ранее srpm-пакета.</h4>
<div class="paragraph">
<p>Пусть у нас есть srpm-пакет <code>foobar-1.0-alt1.src.rpm</code>, и, к примеру, в нём находится следующее:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm -qpl foobar-1.0-alt1.src.rpm
foobar-1-fix.patch
foobar-2-fix.patch
foobar.icon.png
foobar-1.0.tar.bz2
foobar-plugins.tar.gz</code></pre>
</div>
</div>
<div class="paragraph">
<p>Для того чтобы сделать из него gear-репозиторий, нам нужно:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Создать каталог, в котором будет располагаться наш архив:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mkdir foobar
$ cd foobar</code></pre>
</div>
</div>
</li>
<li>
<p>Создать новый git-репозиторий:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ git init
Initialized empty Git repository in .git/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Получившийся пустой git-репозиторий будет выглядеть примерно следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ls -dlog .*
drwxr-xr-x 4 4096 Aug 12 34:56 .
drwxr-xr-x 6 4096 Aug 12 34:56 ..
drwxr-xr-x 8 4096 Aug 12 34:56 .git</code></pre>
</div>
</div>
<div class="paragraph">
<p>Таким образом, git-репозиторий готов для импорта srpm-пакета.</p>
</div>
</li>
<li>
<p>В проекте <code>gear</code> есть утилита gear-srpmimport, предназначенная для автоматизации импортирования srpm-пакета в git-репозиторий:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ gear-srpmimport foobar-1.0-alt1.src.rpm
Committing initial tree deadbeefdeadbeefdeadbeefdeadbeefdeadbeef
gear-srpmimport: Imported foobar-1.0-alt1.src.rpm
gear-srpmimport: Created master branch</code></pre>
</div>
</div>
<div class="paragraph">
<p>После выполнения импорта git-репозиторий будет выглядеть следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ls -Alog
drwxr-xr-x 1 4096 Aug 12 34:56 .gear
drwxr-xr-x 1 4096 Aug 12 34:56 .git
-rw-r--r-- 1 6637 Aug 12 34:56 foobar.spec
drwxr-xr-x 3 4096 Aug 12 34:56 foobar
drwxr-xr-x 3 4096 Aug 12 34:56 foobar-plugins
-rw-r--r-- 1  791 Aug 12 34:56 foobar-1-fix.patch
-rw-r--r-- 1 3115 Aug 12 34:56 foobar-2-fix.patch
-rw-r--r-- 1  842 Aug 12 34:56 foobar.icon.png</code></pre>
</div>
</div>
</li>
<li>
<p>При необходимости в файл правил можно вносить изменения. Например, можно убрать сжатие исходников (соответствующие изменения следует вносить и в spec-файл).</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_создание_gear_репозитория_на_основе_готового_git_репозитория">Создание gear-репозитория на основе готового git-репозитория</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Создать и добавить в git-репозиторий spec-файл.</p>
</li>
<li>
<p>Создать и добавить в git-репозиторий файл с правилами .gear/rules.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_сборка_пакета_из_gear_репозитория">Сборка пакета из gear-репозитория</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Сборка пакета при помощи hasher осуществляется командой gear-hsh:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ gear-hsh</code></pre>
</div>
</div>
</li>
<li>
<p>Чтобы собрать старый пакет, который не содержит определения тега Packager в spec-файле, следует отключить соответствующую проверку:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ gear-hsh --no-sisyphus-check=gpg,packager</code></pre>
</div>
</div>
</li>
<li>
<p>Сборка пакета при помощи rpmbuild(8) осуществляется командой gear-rpm:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ gear-rpm -ba</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_фиксация_изменений_в_репозитории">Фиксация изменений в репозитории</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Для того, чтобы сделать commit очередной сборки пакета, имеет смысл воспользоваться утилитой <code>gear-commit</code>, которая помогает сформировать список изменений на основе записи в spec-файле:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ gear-commit -a</code></pre>
</div>
</div>
</li>
<li>
<p>Прежде чем сделать первый commit, не забудьте сконфигурировать ваш адрес. Это можно сделать глобально несколькими способами, например, прописав соответствующие значения в
<code>~/.gitconfig</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ git config --global user.name 'Your Name'
$ git config --global user.email '&lt;login&gt;@altlinux.org'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Для отдельно взятого git-репозитория сконфигурировать адрес можно, прописав соответствующие значения в <code>.git/config</code> этого git-репозитория:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ git config user.name 'Your Name'
$ git config user.email '&lt;login&gt;@altlinux.org'</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preparing-software-for-packaging">Подготовка программного обеспечения для упаковки</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Эта глава посвящена исходному коду и созданию программного обеспечения, которые являются необходимой основой для сборки RPM.</p>
</div>
<div class="sect2">
<h3 id="what-is-source-code">Что такое Исходный код?</h3>
<div class="paragraph">
<p><strong>Исходный код </strong> - это понятные для человека инструкции к компьютеру, в которых описывается, как выполнить вычисления. Исходный код выражается с помощью
<a href="https://ru.wikipedia.org/wiki/Язык_программирования">языка программирования</a>
.</p>
</div>
<div class="paragraph">
<p>В этом руководстве представлены три версии программы <code>Hello World</code> , каждая из которых написана на разных языках программирования. Программы, написанные на этих трех разных языках, упаковываются по разному и охватывают три основных варианта использования RPM упаковщиком ПО.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
Существуют тысячи языков программирования. В этом документе представлены только три из них, но их достаточно для концептуального обзора.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Программа <code>Hello World</code>, написанная на <a href="https://www.gnu.org/software/bash/">bash</a>:</p>
</div>
<div class="paragraph">
<p><code>bello</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">#!/bin/bash

printf "Hello World\n"</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Hello World</code>, написанная на <a href="https://www.python.org/">Python</a>:</p>
</div>
<div class="paragraph">
<p><code>pello.py</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">#!/usr/bin/env python

print("Hello World")</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Hello World</code>, написанная на
<a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a>
:</p>
</div>
<div class="paragraph">
<p><code>cello.c</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c">#include &lt;stdio.h&gt;

int main(void) {
    printf("Hello World\n");
    return 0;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Целью каждой из трех программ является вывод строки <code>Hello World</code> в
 командной строке.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
Знание того, как программировать, не обязательно для упаковщика программного обеспечения, но полезно.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="how-programs-are-made">Как создаются программы</h3>
<div class="sect3">
<h4 id="natively-compiled-code">Изначально скомпилированный код</h4>

</div>
<div class="sect3">
<h4 id="interpreted-code">Интерпретируемый код</h4>
<div class="sect4">
<h5 id="_программы_с_прямой_интерпретацией">Программы с прямой интерпретацией</h5>

</div>
<div class="sect4">
<h5 id="_программы_скомпилированные_в_байт_код">Программы, скомпилированные в байт-код</h5>

</div>
</div>
</div>
<div class="sect2">
<h3 id="building-software-from-source">Сборка программного обеспечения из исходного кода</h3>
<div class="sect3">
<h4 id="natively-compiled-code-building-software-from-source">Изначально скомпилированный код</h4>
<div class="sect4">
<h5 id="manual-building">Ручная сборка</h5>

</div>
<div class="sect4">
<h5 id="_автоматическая_сборка">Автоматическая сборка</h5>
<div class="paragraph">
<p>Вместо того, чтобы создавать исходный код вручную, вы можете автоматизировать сборку. Это обычная практика, используемая в крупномасштабном программном обеспечении. Автоматизация сборки осуществляется путем создания  <code>Makefile</code> и последующим запуском утилиты
<a href="http://www.gnu.org/software/make/">GNU <code>make</code></a>.</p>
</div>
<div class="paragraph">
<p>Чтобы настроить автоматическую сборку, создайте файл с именем  <code>Makefile</code> в том же каталоге, что и<code>cello.c</code>:</p>
</div>
<div class="paragraph">
<p><code>Makefile</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="makefile">cello:
        gcc -g -o cello cello.c

clean:
        rm cello</code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь, чтобы собрать программу, просто запустите <code>make</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ make
make: 'cello' is up to date.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Посколько сборка уже создана, <code>make clean</code> очистит её, а затем снова запустит <code>make</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ make clean
rm cello

$ make
gcc -g -o cello cello.c</code></pre>
</div>
</div>
<div class="paragraph">
<p>Опять же, попытка сборки после другой сборки ничего не даст:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ make
make: 'cello' is up to date.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Наконец, программа выполнится:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./cello
Hello World</code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь Вы скомпилировали программу как вручную, так и с помощью инструмента сборки.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="interpreted-code-building-software-from-source">Интерпретируемый код</h4>
<div class="paragraph">
<p>Следующие два примера демонстрируют компиляцию в байт-код программы, написанной на
<a href="https://www.python.org/">Python</a> и прямую интерпретацию программы, написанной на
<a href="https://www.gnu.org/software/bash/">bash</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
<div class="paragraph">
<p>В двух приведенных ниже примерах<code>#!</code> строка в верхней части файла называется
<a href="https://en.wikipedia.org/wiki/Shebang_%28Unix%29">shebang</a>
и не является частью исходного кода.</p>
</div>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Shebang_%28Unix%29">shebang</a>
позволяет использовать текстовый файл в качестве исполняемого файла: загрузчик системной программы анализирует строку, содержащую <strong>shebang</strong>, чтобы получить путь к бинарному исполняемому файлу, который затем используется в качестве интерпретатора языка программирования.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="byte-compiled-code">Компиляция в байт-кода</h5>
<div class="paragraph">
<p>В этом примере Вы скомпилируете в  байт-код <code>pello.py</code> - программу, написанную на Python, который затем выполняется виртуальной машиной Python. Исходный код Python также может быть напрямую интерпретирован, но исполнение байт-кода быстрее. Следовательно, RPM упаковщики  предпочитают упаковывать скомпилированный байт-код для распространения среди конечных пользователей.</p>
</div>
<div class="paragraph">
<p><code>pello.py</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">#!/usr/bin/env python

print("Hello World")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Процедура программ в байт-код отличается для разных языков. Это зависит от языка, виртуальной машины языка, а также инструментов и процессов, используемых с этим языком.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
<a href="https://www.python.org/">Python</a> часто компилируется в байт-код, но не так, как описано здесь. Следующая процедура направлена не на то, чтобы соответствовать стандартам сообщества, а на то, чтобы быть простой. Для получения практических рекомендаций по Python см. раздел
<a href="https://docs.python.org/2/library/distribution.html">Упаковка и распространение программного обеспечения</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Компиляция <code>pello.py</code> в байт-код:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ python -m compileall pello.py

$ file pello.pyc
pello.pyc: python 2.7 byte-compiled</code></pre>
</div>
</div>
<div class="paragraph">
<p>Выполните байт-код в <code>pello.pyc</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ python pello.pyc
Hello World</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="raw-interpreted">Напрямую интепретированный код</h5>
<div class="paragraph">
<p>В этом примере Вы будете интерпретировать программу <code>bello</code> написанную на встроенном языке оболочки
<a href="https://www.gnu.org/software/bash/">bash</a>.</p>
</div>
<div class="paragraph">
<p><code>bello</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">#!/bin/bash

printf "Hello World\n"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Для программ, написанных на языках сценариев оболочки, таких как  <em>bash</em>, используется прямая интерпретация.
Следовательно, Вам нужно только сделать файл с исходным кодом исполняемым и запустить его:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ chmod +x bello
$ ./bello
Hello World</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="patching-software">Программное обеспечение для исправления ошибок</h3>
<div class="paragraph">
<p><strong>Patch</strong> - это исходный код, который исправляет другой исходный код. Он отформатирован как <em>diff</em>, потому что представляет разницу между двумя версиями текста. Разница создаётся с помощью утилиты <code>diff</code>, которая затем применяется к исходному коду с помощью утилиты <a href="http://savannah.gnu.org/projects/patch/">patch</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
Разработчики программного обеспечения часто используют системы контроля версий, такие как <a href="https://git-scm.com/">git</a>, для управления своей кодовой базой. Такие инструменты предоставляют свои собственные методы создания различий или исправления программного обеспечения.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>В следующем примере мы создаем исправление из исходного кода с помощью
<code>diff</code>, а затем используем <code>patch</code>. Исправление использует в следующих разделах при создании RPM и работе со .spec-файлом. <a href="#working-with-spec-files">Работа со SPEC файлами</a>.</p>
</div>
<div class="paragraph">
<p>Как исправление связано с упаковкой RPM? В упаковке, вместо того, чтобы просто изменять исходный код, мы сохраняем его и используем на нем исправления.</p>
</div>
<div class="paragraph">
<p>Чтобы создать патч для <code>cello.c</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Сохраним исходный код:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cp cello.c cello.c.orig</code></pre>
</div>
</div>
<div class="paragraph">
<p>Это наиболее распространённый способ сохранить файл исходного кода.</p>
</div>
</li>
<li>
<p>Изменим<code>cello.c</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c">#include &lt;stdio.h&gt;

int main(void) {
    printf("Hello World from my very first patch!\n");
    return 0;
}</code></pre>
</div>
</div>
</li>
<li>
<p>Сгенерируем патч используя утилиту <code>diff</code>:</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
Мы используем несколько общих аргументов для утилиты <code>diff</code>. Для получения дополнительной информации о них см. руководство по использованию <code>diff</code>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="diff">$ diff -Naur cello.c.orig cello.c
--- cello.c.orig        2016-05-26 17:21:30.478523360 -0500
+++ cello.c     2016-05-27 14:53:20.668588245 -0500
@@ -1,6 +1,6 @@
 #include&lt;stdio.h&gt;

 int main(void){
-    printf("Hello World!\n");
+    printf("Hello World from my very first patch!\n");
     return 0;
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Строки, начинающиеся с <code>-</code> удалятся из исходного кода и заменятся на строки, начинающихся с  <code>+</code>.</p>
</div>
</li>
<li>
<p>Сохраним патч в файл:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ diff -Naur cello.c.orig cello.c &gt; cello-output-first-patch.patch</code></pre>
</div>
</div>
</li>
<li>
<p>Восстановим исходный код <code>cello.c</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cp cello.c.orig cello.c</code></pre>
</div>
</div>
<div class="paragraph">
<p>Мы сохраняем исходный файл <code>cello.c</code>, потому что при создании RPM используется исходный файл, а не измененный. Дополнительные сведения см. в разделе
<a href="#working-with-spec-files">Работа со SPEC файлами</a>.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Чтобы исправить <code>cello.c</code> с помощью <code>cello-output-first-patch.patch</code>, перенаправьте патч-файл <code>patch</code> коммандой:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ patch &lt; cello-output-first-patch.patch
patching file cello.c</code></pre>
</div>
</div>
<div class="paragraph">
<p>Содержимое <code>cello.c</code> теперь отражает изменения:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cat cello.c
#include&lt;stdio.h&gt;

int main(void){
    printf("Hello World from my very first patch!\n");
    return 0;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Чтобы собрать и запустить отредактированную <code>cello.c</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ make clean
rm cello

$ make
gcc -g -o cello cello.c

$ ./cello
Hello World from my very first patch!</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вы создали патч, отредактировали программу, собрали отредактированную программу и запустили её.</p>
</div>
</div>
<div class="sect2">
<h3 id="installing-arbitrary-artifacts">Установка Произвольных Артефактов</h3>
<div class="paragraph">
<p>Большим преимуществом
<a href="https://en.wikipedia.org/wiki/Linux">Linux</a>
и других Unix-подобных систем является
<a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">Стандарт иерархии файловой системы</a>
. Он указывает, в каком каталоге должны быть расположены файлы.
Файлы, установленные из пакетов RPM, должны быть размещены в соответствии с ИФС. Например, исполняемый файл должен находиться в каталоге, который находится в переменной
<a href="https://en.wikipedia.org/wiki/PATH_%28variable%29">PATH</a>
.</p>
</div>
<div class="paragraph">
<p>В контексте этого руководства, <em>Произвольный артефакт</em> - это все, что устанавливается из RPM в систему. Для RPM и для системы это может быть скрипт, бинарный файл, скомпилированный из исходного кода пакета, предварительно скомпилированный бинарный файл или любой другой файл.</p>
</div>
<div class="paragraph">
<p>Мы рассмотрим два популярных способа размещения <em>произвольных артефактов</em> в системе: с помощью команды <code>install</code> и с помощью команды <code>make install</code>.</p>
</div>
<div class="sect3">
<h4 id="install-command">Использование команды install</h4>
<div class="paragraph">
<p>Иногда с помощью инструментов автоматизации сборки, таких как
<a href="http://www.gnu.org/software/make/">GNU make</a> не является оптимальным - например, если упакованная программа проста. В этих случаях упаковщики часто используют команду <code>install</code> (предоставляемая системе
<a href="http://www.gnu.org/software/coreutils/coreutils.html">coreutils</a>), которая помещает артефакт в указанный каталог в файловой системе с указанным набором разрешений.</p>
</div>
<div class="paragraph">
<p>В приведенном ниже примере будет использоваться файл <code>bello</code>,  который мы ранее создали в качестве произвольного артефакта, зависящего от нашего метода установки.  Обратите внимание, что Вам либо понадобятся разрешения  <a href="http://www.sudo.ws/">sudo</a>, либо запустите эту команду от имени root, исключая часть команды <code>sudo</code>.</p>
</div>
<div class="paragraph">
<p>В этом примере <code>install</code> помещает файл <code>bello</code> в <code>/usr/bin</code> с разрешениями, общими для исполняемых скриптов:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ sudo install -m 0755 bello /usr/bin/bello</code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь<code>bello</code> находится в каталоге, который указан в переменной
<a href="https://en.wikipedia.org/wiki/PATH_%28variable%29">$PATH</a>
. Таким образом, Вы можете запустить <code>bello</code> из любого каталога, не указывая его путь:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd ~

$ bello
Hello World</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="make-install">Использование команды make install</h4>
<div class="paragraph">
<p>Популярным автоматизированным способом установки программного обеспечения в систему является использование команды <code>make install</code>. Вы указываете, как установить произвольные артефакты в систему в файле <code>Makefile</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
Обычно <code>Makefile</code> пишется разработчиком, а не упаковщиком.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Добавьте секцию <code>install</code> в <code>Makefile</code>:</p>
</div>
<div class="paragraph">
<p><code>Makefile</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="makefile">cello:
        gcc -g -o cello cello.c

clean:
        rm cello

install:
        mkdir -p $(DESTDIR)/usr/bin
        install -m 0755 cello $(DESTDIR)/usr/bin/cello</code></pre>
</div>
</div>
<div class="paragraph">
<p>Переменная <a href="https://www.gnu.org/software/make/manual/html_node/DESTDIR.html">$(DESTDIR)</a>
является встроенной в  <a href="http://www.gnu.org/software/make/">GNU make</a> и обычно используется для указания установки в каталог, отличный от корневого каталога.</p>
</div>
<div class="paragraph">
<p>Теперь вы можете использовать <code>Makefile</code> не только для сборки программного обеспечения, но и для его установки в систему.</p>
</div>
<div class="paragraph">
<p>Для сборки и установки программы <code>cello.c</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ make
gcc -g -o cello cello.c

$ sudo make install
install -m 0755 cello /usr/bin/cello</code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь<code>cello</code> находится в каталоге, который указан в переменной
<a href="https://en.wikipedia.org/wiki/PATH_%28variable%29">$PATH</a>
. Таким образом, Вы можете запустить <code>cello</code> из любого каталога, не указывая его полный путь.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd ~

$ cello
Hello World</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вы установили артефакт сборки в выбранное место в системе.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="preparing-source-code-for-packaging">Подготовка исходного кода для упаковки</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
Код, созданный в этом разделе, можно найти
<a href="https://github.com/altlinux/alt-packaging-guide/tree/master/example-code">здесь</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Разработчики часто распространяют программное обеспечение в виде сжатых архивов исходного кода, которые затем используются для создания пакетов. В этом разделе Вы создадите такие архивы.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
Создание архивов исходного кода обычно выполняется не RPM-упаковщиком, а разработчиком. Упаковщик работает с готовым архивом исходного кода.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Программное обеспечение должно распространяться с
<a href="https://ru.wikipedia.org/wiki/Лицензия_на_программное_обеспечение">лицензией</a>
. Для примера мы будем использовать лицензию
<a href="https://www.gnu.org/licenses/quick-guide-gplv3.html">GPLv3</a>. Текст лицензии помещается в файл <code>LICENSE</code> для каждой из примеров программ. Упаковщику RPM необходимо иметь дело с файлами лицензий при упаковке.</p>
</div>
</div>
<div class="sect2">
<h3 id="putting-source-code-into-tarball">Создание Tarball с исходным кодом</h3>
<div class="paragraph">
<p>В приведенных ниже примерах мы помещаем каждую из трех программ  <code>Hello World</code> в архив, сжатый с помощью
<a href="https://www.gnu.org/software/gzip/">gzip</a>. Программное обеспечение часто выпускается таким образом, чтобы позже быть упакованным для распространения.</p>
</div>
<div class="sect3">
<h4 id="bello">bello</h4>
<div class="paragraph">
<p>Проект <em>bello</em> реализует <code>Hello World</code> в
<a href="https://www.gnu.org/software/bash/">bash</a>. Реализация содержит только сценарий оболочки <code>bello</code>, поэтому результирующий архив <code>tar.gz</code> будет содержать только один файл, кроме файла  <code>LICENSE</code>. Давайте предположим, что это версия программы - <code>0.1</code></p>
</div>
<div class="paragraph">
<p>Подготовьте проект <em>bello</em> для распространения:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Поместите файлы в один каталог:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mkdir /tmp/bello-0.1

$ mv ~/bello /tmp/bello-0.1/

$ cp /tmp/LICENSE /tmp/bello-0.1/</code></pre>
</div>
</div>
</li>
<li>
<p>Создайте архив и переместите его в <code>~/rpmbuild/SOURCES/</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd /tmp/

$ tar -cvzf bello-0.1.tar.gz bello-0.1
bello-0.1/
bello-0.1/LICENSE
bello-0.1/bello

$ mv /tmp/bello-0.1.tar.gz ~/rpmbuild/SOURCES/</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="pello">pello</h4>
<div class="paragraph">
<p>Проект <em>pello</em> реализует <code>Hello World</code> на
<a href="https://www.python.org/">Python</a>. Реализация содержит только программу
<code>pello.py</code>, так что результирующий архив <code>tar.gz</code> будет содержать только один файл, кроме файла  <code>LICENSE</code>. Предположим, что это версия программы -
<code>0.1.1</code></p>
</div>
<div class="paragraph">
<p>Подготовьте проект <em>pello</em> для распространения:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Поместите файлы в один каталог:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mkdir /tmp/pello-0.1.1

$ mv ~/pello.py /tmp/pello-0.1.1/

$ cp /tmp/LICENSE /tmp/pello-0.1.1/</code></pre>
</div>
</div>
</li>
<li>
<p>Создайте архив для распространения и переместите его в <code>~/rpmbuild/SOURCES/</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd /tmp/

$ tar -cvzf pello-0.1.1.tar.gz pello-0.1.1
pello-0.1.1/
pello-0.1.1/LICENSE
pello-0.1.1/pello.py

$ mv /tmp/pello-0.1.1.tar.gz ~/rpmbuild/SOURCES/</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="cello">cello</h4>
<div class="paragraph">
<p>Проект <em>cello</em> реализует <code>Hello World</code> на
<a href="https://ru.wikipedia.org/wiki/Си_(язык_программирования)">C</a>
. Реализация содержит только файлы <code>cello.c</code> и
<code>Makefile</code>, поэтому результирующий архив <code>tar.gz</code>  будет содержать только два файла, помимо файла <code>LICENSE</code>. Давайте предположим, что это версия программы - <code>1.0</code></p>
</div>
<div class="paragraph">
<p>Обратите внимание, что <code>patch</code> не распространяется в архиве вместе с программой.
Упаковщик RPM применяет исправление при создании RPM. Патч будет помещен в каталог <code>~/rpmbuild/SOURCES/</code> рядом с <code>.tar.gz</code> архивом.</p>
</div>
<div class="paragraph">
<p>Подготовьте проект <em>cello</em> для распространения:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Поместите файлы в один каталог:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mkdir /tmp/cello-1.0

$ mv ~/cello.c /tmp/cello-1.0/

$ mv ~/Makefile /tmp/cello-1.0/

$ cp /tmp/LICENSE /tmp/cello-1.0/</code></pre>
</div>
</div>
</li>
<li>
<p>Создайте архив для распространения и переместите его в  <code>~/rpmbuild/SOURCES/</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd /tmp/

$ tar -cvzf cello-1.0.tar.gz cello-1.0
cello-1.0/
cello-1.0/Makefile
cello-1.0/cello.c
cello-1.0/LICENSE

$ mv /tmp/cello-1.0.tar.gz ~/rpmbuild/SOURCES/</code></pre>
</div>
</div>
</li>
<li>
<p>Добавьте патч:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mv ~/cello-output-first-patch.patch ~/rpmbuild/SOURCES/</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Теперь исходный код готов к упаковке в RPM.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="building-rpm">Примеры сборки пакетов с использованием инструментов Альт</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Для примера сборки пакета будем использовать программу для вывода системных уведомлений о текущей дате и времени.
Ссылка на github-репозиторий с исходными текстами программ на языках C++ (<a href="https://github.com/MakDaffi/notification">Notification</a>) и Python (<a href="https://github.com/danila-Skachedubov/DBusTimer_example">DBusTimer_Example</a>)</p>
</div>
<div class="paragraph">
<p>Структура репозиториев для данных программ идентична: Главный файл (.cpp или .py) и два юнита systemd (.service и .timer)</p>
</div>
<div class="paragraph">
<p>Вдаваться в подробности написания кода мы не будем, так как основная цель - сборка пакета, а не разработка приложения. </p>
</div>
<div class="paragraph">
<p>Файл .timer - юнит systemd, который при истечении заданного времени будет вызывать скрипт .py, который выводит уведомление о дате и времени. После срабатывания таймер снова начинает отсчёт до запуска скрипта.</p>
</div>
<div class="paragraph">
<p>Файл .service - содержит описание, расположение скрипта .py и интерпретатора, который будет обрабатывать скрипт.</p>
</div>
<div class="sect2">
<h3 id="_подготовка_пространства">Подготовка пространства</h3>
<div class="paragraph">
<p>Первым шагом Вам необходимо склонировать репозиторий в Вашу рабочую директорию, используя команду <code>git clone (адрес репозитория DBusTimer_Example из ссылки выше)</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ git clone https://github.com/danila-Skachedubov/DBusTimer_example.git

Cloning into 'DBusTimer_example'...
remote: Enumerating objects: 5, done.
remote: Counting objects: 100% (5/5), done.
remote: Compressing objects: 100% (5/5), done.
remote: Total 5 (delta 0), reused 5 (delta 0), pack-reused 0
Receiving objects: 100% (5/5), done.</code></pre>
</div>
</div>
<div class="paragraph">
<p>В рабочей директории появится каталог с названием проекта: DBusTimer_Example.</p>
</div>
<div class="paragraph">
<p>Создадим каталог <code>.gear</code> и перейдём в него.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">DBusTimer_example $ mkdir .gear
DBusTimer_example $ cd .gear/
.gear $</code></pre>
</div>
</div>
<div class="paragraph">
<p>В каталоге <code>.gear</code> создадим два файла: правила для <code>gear - rules</code> и <code>spec</code> файл - <code>dbustimer.spec</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">.gear $ touch rules dbustimer.spec</code></pre>
</div>
</div>
<div class="paragraph">
<p>После всех изменений содержание каталога проекта примет следующий вид:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">DBusTimer_example $ ls -la
итого 28
drwxr-xr-x  4 sova domain users 4096 апр 20 14:20 .
drwxr-xr-x 10 sova domain users 4096 апр 20 14:06 ..
drwxr-xr-x  2 sova domain users 4096 апр 20 14:24 .gear
drwxr-xr-x  8 sova domain users 4096 апр 20 14:06 .git
-rwxr-xr-x  1 sova domain users  413 апр 20 14:06 script_dbus.py
-rw-r--r--  1 sova domain users  186 апр 20 14:06 script_dbus.service
-rw-r--r--  1 sova domain users  106 апр 20 14:06 script_dbus.timer
DBusTimer_example $ ls .gear/
dbustimer.spec  rules</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_написание_spec_файла_и_правил_gear">Написание spec файла и правил Gear</h3>
<div class="paragraph">
<p>Следующим этапом сборки будет написание <code>spec</code> файла и правил для gear.</p>
</div>
<div class="paragraph">
<p>В каталоге .gear откроем файл <code>rules</code>. Заполним его следующим содержимым:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">tar: .
spec: .gear/dbustimer.spec</code></pre>
</div>
</div>
<div class="paragraph">
<p>Первая строка указывает, что проект будет упакован в <code>.tar</code> архив. Вторая строка указывает путь к расположению <code>.spec</code> файла.
На этом этапе редактирование <code>rules</code> заканчивается.</p>
</div>
<div class="paragraph">
<p>Перейдём к написанию <code>.spec</code> файла.</p>
</div>
<div class="paragraph">
<p>В заголовке или шапке спек файла находятся секции Name, Version, Release, Summary, License, Group, BuildArch, BuildRequires, Source0.</p>
</div>
<div class="paragraph">
<p>Заполнив данные секции, заголовок spec файла примет вид:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">Name: dbustimer
Version: 0.4
Release: alt1

Summary: Display system time
License: GPLv3+
Group: Other
BuildArch: noarch

BuildRequires: rpm-build-python3</code></pre>
</div>
</div>
<div class="paragraph">
<p>Стандартная схема Name-Version-Release, содержащая в себе имя пакета, его версию и релиз сборки. Поле Summary включает в себя краткое описание пакета. License - лицензия, под которой выпускается данное ПО. В данном случае - GPLv3. Группа - категория, к которой относится пакет. Так как это тестовый пакет для примера, выставим группу "Other". BuildRequires - пакеты, необходимые для <em>сборки</em>. Так как исходный код написан на python3, нам необходим пакет <code>rpm-build-python3</code> с макросами для сборки скриптов Python. Source0 - путь к архиву с исходниками (%name-%version.tar). На этом заголовок .spec файла заканчивается.</p>
</div>
<div class="paragraph">
<p>Далее - тело, или основная часть .spec файла. В ней описывается сам процесс сборки и инструкции к преобразованию исходных файлов.</p>
</div>
<div class="paragraph">
<p>Начнём с заполнения полей <code>%description</code> и <code>%prep</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">%description
This program displays notifications about the system time with a frequency of one hour.

%prep
%setup -q</code></pre>
</div>
</div>
<div class="paragraph">
<p>В секции <code>%description</code> находится краткое описание программы. Секция <code>%prep</code> отвечает за подготовку программы к сборке. Макрос <code>%setup</code> распаковывает исходный код перед компиляцией.</p>
</div>
<div class="paragraph">
<p>В секции %install описаны инструкции, как установить файлы пакета в систему конечного пользователя.</p>
</div>
<div class="paragraph">
<p>Вместо того, чтобы писать пути установки файлов вручную, будем использовать предопределённые макросы:
<code>%python3_sitelibdir_noarch</code> будет раскрываться в путь <code>/usr/lib/python3/site-packages</code>. По этому пути будет создан каталог с именем пакета, в который будет помещён файл <code>script_dbus.py</code> с правами доступа 755.</p>
</div>
<div class="paragraph">
<p>Аналогичная операция будет проведена с файлами <code>script_dbus.timer</code> и <code>script_dbus.service</code>. Они должны быть установлены по пути <code>/etc/xdg/systemd/user</code>. Так как макроса, раскрывающегося в данный путь нет, будет использован макрос <code>%_sysconfdir</code>, который раскрывается в путь <code>/etc</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">%install


mkdir -p \
	%buildroot%python3_sitelibdir_noarch/%name/
install -Dm0755 script_dbus.py \
	%buildroot%python3_sitelibdir_noarch/%name/

mkdir -p \
	%buildroot%_sysconfdir/xdg/systemd/user/
cp script_dbus.timer script_dbus.service \
	%buildroot%_sysconfdir/xdg/systemd/user/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Команда <code>mkdir -p \
%buildroot%python3_sitelibdir_noarch/%name/</code> создаёт каталог <code>dbustimer</code> в окружении <code>buildroot</code> по пути
<code>/usr/lib/python3/site-packages</code></p>
</div>
<div class="paragraph">
<p>Следующим действием происходит установка файла <code>script_dbus.py</code> с правами 755 в каталог <code>/usr/lib/python3/site-packages/dbustimer/</code> в окружении <code>buildroot</code>.</p>
</div>
<div class="paragraph">
<p>Аналогично создаётся каталог <code>%buildroot%_sysconfdir/xdg/systemd/user/</code>, в который копируются файлы .service и .timer</p>
</div>
<div class="paragraph">
<p>Секция %files</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">%files
%python3_sitelibdir_noarch/%name/script_dbus.py
/etc/xdg/systemd/user/script_dbus.service
/etc/xdg/systemd/user/script_dbus.timer</code></pre>
</div>
</div>
<div class="paragraph">
<p>В секции %files описано, какие файлы и каталоги с соответствующими атрибутами должны быть скопированы из дерева сборки в rpm-пакет, а затем будут копироваться в целевую систему при установке этого пакета. Все три
файла из пакета будут распакованы по путям, описанным в секции %install.</p>
</div>
<div class="paragraph">
<p>Секция %changelog. Здесь описаны изменения внесённые в ПО, патчи, изменения методологии сборки</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">%changelog
* Thu Apr 13 2023 Danila Skachedubov &lt;dan@altlinux.org&gt; 0.4-alt1
- Update system
- Changed access rights</code></pre>
</div>
</div>
<div class="paragraph">
<p>После всех манипуляций Ваш .spec файл будет выглядеть следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">Name: dbustimer
Version: 0.4
Release: alt1

Summary: Display system time
License: GPLv3+
Group: Other
BuildArch: noarch

BuildRequires: rpm-build-python3

Source0: %name-%version.tar

%description
This program displays notifications about the system time with a frequency of one hour.

%prep
%setup

%install

mkdir -p \
	%buildroot%python3_sitelibdir_noarch/%name/
install -Dm0755 script_dbus.py \
	%buildroot%python3_sitelibdir_noarch/%name/

mkdir -p \
	%buildroot%_sysconfdir/xdg/systemd/user/
cp script_dbus.timer script_dbus.service \
	%buildroot%_sysconfdir/xdg/systemd/user/


%files
%python3_sitelibdir_noarch/%name/script_dbus.py
/etc/xdg/systemd/user/script_dbus.service
/etc/xdg/systemd/user/script_dbus.timer

%changelog
* Thu Apr 13 2023 Danila Skachedubov &lt;dan@altlinux.org&gt; 0.4-alt1
- Update system
- Changed access rights</code></pre>
</div>
</div>
<div class="paragraph">
<p>Сохраним файл и перейдём в основную директорию нашего проекта.</p>
</div>
<div class="paragraph">
<p>Теперь необходимо добавить созданные нами файлы на отслеживание git.
Сделать это можно с помощью команды:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ git add .gear/rules .gear/dbustimer.spec</code></pre>
</div>
</div>
<div class="paragraph">
<p>После добавление файлов на отслеживание, запустим сборку с помощью инструментов gear и hasher следующей командой:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ gear-hsh --no-sisyphus-check --commit -v</code></pre>
</div>
</div>
<div class="paragraph">
<p>Если сборка прошла успешно, собранный пакет <code>dbustimer-0.4-alt1.noarch.rpm</code> будет находится в каталоге <code>~/hasher/repo/x86_64/RPMS.hasher/</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_описание_пакета_с_исходными_текстами_на_c">Описание пакета с исходными текстами на C++</h3>
<div class="paragraph">
<p>Ссылка на GitHub репозиторий: <a href="https://github.com/MakDaffi/notification">Notification</a>.</p>
</div>
<div class="paragraph">
<p>Данная программа выводит системное уведомление о текущей дате и времени в формате: <code>День недели, месяц, число, чч:мм:сс, год.</code></p>
</div>
<div class="paragraph">
<p>В репозитории находятся следующие файлы:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>.gear  -  каталог с правилами gear и .spec файлом</p>
</li>
<li>
<p>Makefile — набор инструкций для программы make, которая собирает данный проект.</p>
</li>
<li>
<p>notify.cpp - исходный код программы</p>
</li>
<li>
<p>notify.service - юнит данной программы для systemd</p>
</li>
<li>
<p>notify.timer - юнит systemd, запускающий вывод уведомления о дате и времени с переодичностью в один час.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>В каталоге .gear находятся два файла:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>rules - правила для упаковки архива для gear</p>
</li>
<li>
<p>notify.spec - файл спецификации для сборки пакета</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Остановимся подробнее на этих двух файлах.</p>
</div>
<div class="paragraph">
<p>Перейдём к содержанию файла <code>rules</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">tar: .
spec: .gear/notify.spec</code></pre>
</div>
</div>
<div class="paragraph">
<p>Первая строка - указания для gear, в какой формат упаковать файлы для последующей сборки. В данном проекте архив будет иметь вид <code>name-version.tar</code>.</p>
</div>
<div class="paragraph">
<p>Вторая строка - путь к .spec файлу с инструкциями по сборке текущего пакета.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">Name: notify
Version: 0.1
Release: alt1

Summary: Display system time every hour
License: GPLv3+
Group: Other

BuildRequires: make
BuildRequires: gcc-c++
BuildRequires: libsystemd-devel Работа с ключами разработчика.

Создание заявки

Source0: %name-%version.tar

%description
This test program displays system date and time every hour via notification

%prep
%setup -q

%build
%make_build

%install

mkdir -p \
	%buildroot/bin/
install -Dm0644 %name %buildroot/bin/

mkdir -p \
	%buildroot%_sysconfdir/xdg/systemd/user/
cp %name.timer %name.service \
	%buildroot%_sysconfdir/xdg/systemd/user/

%files
/bin/%name
/etc/xdg/systemd/user/%name.service
/etc/xdg/systemd/user/%name.timer

%changelog
* Thu Apr 13 2023 Sergey Okunkov &lt;sok@altlinux.org&gt; 0.1-alt1
- Finished my task</code></pre>
</div>
</div>
<div class="paragraph">
<p>В заголовке или "шапке" .spec файла описаны следующие поля:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">Name: notify
Version: 0.1
Release: alt1

Summary: Display system time every hour
License: GPLv3+
Group: Other

BuildRequires: make
BuildRequires: gcc-c++
BuildRequires: libsystemd-devel

Source0: %name-%version.tar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Стандартная схема Name-Version-Release, содержащая в себе имя пакета, его версию и релиз сборки. Поле Summary включает в себя краткое описание пакета. License - лицензия, под которой выпускается данное ПО. В данном случае - GPLv3. Группа - категория, к которой относится пакет. Так как это тестовый пакет для примера, выставим группу "Other". BuildRequares - пакеты, необходимые для <em>сборки</em>. Так как исходный код написан на c++, нам необходим компилятор <code>g + +</code>, система сборки программы - make и библиотека для работы с модулями systemd - <code>libsystemd-devel</code>. Source0 - путь к архиву с исходниками (%name-%version.tar). На этом заголовок .spec файла заканчивается.</p>
</div>
<div class="paragraph">
<p>Тело .spec файла, или же его основная часть.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">%description
This test program displays system date and time every hour via notification

%prep
%setup -q

%build
%make

%install

mkdir -p \
	%buildroot/bin/
install -Dm0644 %name %buildroot/bin/

mkdir -p \
	%buildroot%_sysconfdir/xdg/systemd/user/
cp %name.timer %name.service \
	%buildroot%_sysconfdir/xdg/systemd/user/

%files
/bin/%name
/etc/xdg/systemd/user/%name.service
/etc/xdg/systemd/user/%name.timer</code></pre>
</div>
</div>
<div class="paragraph">
<p>Секция %description - описание того, что делает программа. В данном примере - вывод системного уведомления с датой и временем.</p>
</div>
<div class="paragraph">
<p>Секция %prep. Макрос %setup с флагом <code>-q</code> распаковывает архив, описанный в секции Source0.</p>
</div>
<div class="paragraph">
<p>В секции %build происходит <em>сборка исходного кода</em>. Так как в примере присутствует Makefile для автоматизации процесса сборки, то в секции будет указан макрос %make_build, использующий Makefile для сборки программы.</p>
</div>
<div class="paragraph">
<p>Секция %install</p>
</div>
<div class="paragraph">
<p>Здесь происходит эмуляция конечных путей при установке файлов в систему. Мы переносим файл в buildroot в те пути, куда файлы будут помещены после установки пакета в систему пользователя. Так как файла три, для каждого пропишем конечный путь:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>notify</code> - скомпилированный бинарный файл. В Unix-подобных системах бинарные файлы располагаются в каталоге
/bin. <code>mkdir -p %buildroot/bin</code> - строка, в которой создаётся каталог bin в окружении buildroot. Следующая строка - <code>install -Dm0644 %name %buildroot/bin/</code> - установка бинарного файла notify в каталог <code>%buildroot/bin/</code> с разрешениями 644.</p>
</li>
<li>
<p><code>%name.timer</code>, <code>%name.service</code> - юниты systemd. Данные юниты относятся к пользовательским и находятся в <code>/etc/xdg/systemd/user/</code>. Как и для предыдущего файла, создадим в окружении buildroot каталог <code>mkdir -p %buildroot%_sysconfdir/xdg/systemd/user/</code>. В пути использован макрос <code>%_sysconfdir</code>, который заменяется путём
<code>/etc</code>. Следующая строка <code>cp %name.timer %name.service %buildroot%_sysconfdir/xdg/systemd/user/</code> - переносит данные файлы по заданному пути в окружении buildroot.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Секция %files</p>
</div>
<div class="paragraph">
<p>Описывает какие файлы и директории будут скопрованы в систему при установке пакета.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/bin/%name
/etc/xdg/systemd/user/%name.service
/etc/xdg/systemd/user/%name.timer</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_программное_обеспечение_для_исправления_ошибок">Программное обеспечение для исправления ошибок</h3>
<div class="paragraph">
<p><strong>Patch</strong> - это исходный код, который исправляет другой исходный код. Он отформатирован как <em>diff</em>, потому что представляет разницу между двумя версиями текста. Разница создаётся с помощью утилиты <code>diff</code>, которая затем применяется к исходному коду с помощью утилиты <a href="http://savannah.gnu.org/projects/patch/">patch</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
Разработчики программного обеспечения часто используют системы контроля версий, такие как <a href="https://git-scm.com/">git</a>, для управления своей кодовой базой. Такие инструменты предоставляют свои собственные методы создания различий или исправления программного обеспечения.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>В следующем примере мы создаем исправление из исходного кода с помощью
<code>diff</code>, а затем используем <code>patch</code>. Исправление использует в следующих разделах при создании RPM и работе со .spec-файлом.</p>
</div>
</div>
<div class="sect2">
<h3 id="version-control-systems">Система контроля версий</h3>
<div class="paragraph">
<p>При работе с RPMs желательно использовать
<a href="https://en.wikipedia.org/wiki/Version_control">Системы контроля версий</a> (VCS), такую как <a href="https://git-scm.com/">git</a>, для управления компонентами программного обеспечения, которое мы упаковываем.
Следует отметить, что хранение бинарных файлов в системе контроля версий нецелесообразно, поскольку это резко увеличивает размер исходного репозитория, поскольку эти инструменты разработаны для обработки различий в файлах (часто оптимизированных для текстовых файлов), чему не поддаются бинарные файлы, поэтому обычно сохраняется весь бинарные файл целиком. Существуют некоторые утилиты, популярные среди upstream проектов с открытым исходным кодом, которые решают эту проблему, либо сохраняя SPEC файл, где исходный код находится в VCS (т. е. - он не находится в сжатом архиве для распространения ), либо помещая в VCS только SPEC-файл и патчи и загружается сжатый архив updtream исходного кода  в так называемый «кэш просмотра».</p>
</div>
<div class="paragraph">
<p>В этом разделе мы рассмотрим два различных варианта использования системы контроля версий
<a href="https://git-scm.com/">git</a> для управления содержимым, которое в конечном итоге будет преобразовано в пакет RPM. Первый называется <a href="https://github.com/dgoodwin/tito">tito</a>,
второй - <a href="https://github.com/release-engineering/dist-git">dist-git</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
Вам нужно будет установить пакет <code>git</code> в Вашу систему, он понадобится нам для изучения данного раздела.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advanced-topics">Дополнительные материалы</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В этой главе рассматриваются темы, которые выходят за рамки вводного руководства, но часто полезны в реальной упаковке RPM.</p>
</div>
<div class="sect2">
<h3 id="Signing-Packages">Подпись пакетов</h3>
<div class="paragraph">
<p>Подпись пакета - это способ защитить пакет для конечного пользователя. Безопасная транспортировка может быть достигнута с помощью реализации протокола HTTPS. Такой метод используют, когда пакет загружается непосредственно перед установкой. Однако пакеты часто загружаются заранее и хранятся в локальных репозиториях перед их использованием. Пакеты подписываются, чтобы гарантировать, что никакая третья сторона не сможет изменить содержимое пакета.</p>
</div>
<div class="paragraph">
<p>Существует три способа подписи пакета:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#Adding-a-Signature-to-a-Package">Добавление подписи к уже существующему пакету</a>.</p>
</li>
<li>
<p><a href="#Replacing-a-Package-Signature">Замена подписи на уже существующем пакете</a>.</p>
</li>
<li>
<p><a href="#Build-time-Signing">
Подпись пакета во время сборки</a>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="Adding-a-Signature-to-a-Package">Добавление подписи к пакету</h4>
<div class="paragraph">
<p>В большинстве случаев пакеты создаются без подписи. Подпись добавляется непосредственно перед выпуском пакета.</p>
</div>
<div class="paragraph">
<p>Чтобы добавить другую подпись к пакету, используйте опцию <code>--addsign</code>. Наличие более чем одной подписи позволяет зафиксировать путь владения пакетом от разработчика пакета до конечного пользователя.</p>
</div>
<div class="paragraph">
<p>В качестве примера подразделение компании создает пакет и подписывает его ключом подразделения. Затем штаб-квартира компании проверяет подпись пакета и добавляет корпоративную подпись к пакету, заявляя, что подписанный пакет является подлинным.</p>
</div>
<div class="paragraph">
<p>С двумя подписями пакет попадает к продавцу. Продавец проверяет подписи и, если они проверяются, также добавляет свою подпись.</p>
</div>
<div class="paragraph">
<p>Теперь пакет отправляется в компанию, которая желает его развернуть. Проверив каждую подпись на упаковке, они знают, что это подлинная копия, не изменившаяся с момента её первого создания. В зависимости от внутреннего контроля внедряющей компании, они могут добавить свою собственную подпись, чтобы заверить своих сотрудников в том, что пакет получил их корпоративное одобрение.</p>
</div>
<div class="paragraph">
<p>Вывод из команды <code>--addsign</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --addsign blather-7.9-1.i386.rpm
            Enter pass phrase:

Pass phrase is good.
blather-7.9-1.i386.rpm:</code></pre>
</div>
</div>
<div class="paragraph">
<p>Для проверки подписей пакета с несколькими подписями:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --checksig blather-7.9-1.i386.rpm
blather-7.9-1.i386.rpm: size pgp pgp md5 OK</code></pre>
</div>
</div>
<div class="paragraph">
<p>Два обозначения <code>pgp</code> в выходных данных команды <code>rpm --checksig</code> показывают, что пакет был подписан дважды.</p>
</div>
<div class="paragraph">
<p>RPM позволяет добавлять одну и ту же подпись несколько раз. Параметр <code>--addsign</code>
не проверяет наличие нескольких идентичных подписей.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --addsig blather-7.9-1.i386.rpm
              Enter pass phrase:

Pass phrase is good.
blather-7.9-1.i386.rpm:
$ rpm --addsig blather-7.9-1.i386.rpm
              Enter pass phrase:

Pass phrase is good.
blather-7.9-1.i386.rpm:
$ rpm --addsig blather-7.9-1.i386.rpm
              Enter pass phrase:

Pass phrase is good.
blather-7.9-1.i386.rpm:
$ rpm --checksig blather-7.9-1.i386.rpm
blather-7.9-1.i386.rpm: size pgp pgp pgp pgp md5 OK</code></pre>
</div>
</div>
<div class="paragraph">
<p>На выходе команды <code>rpm --checksig</code> отображается четыре подписи.</p>
</div>
</div>
<div class="sect3">
<h4 id="Replacing-a-Package-Signature">Замена подписи пакета</h4>
<div class="paragraph">
<p>Чтобы изменить открытый ключ без необходимости пересобирать каждый пакет, используйте опцию <code>--resign</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --resign blather-7.9-1.i386.rpm
            Enter pass phrase:

Pass phrase is good.
blather-7.9-1.i386.rpm:</code></pre>
</div>
</div>
<div class="paragraph">
<p>Использование опции <code>--resign</code> с несколькими пакетами:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --resign b*.rpm
            Enter pass phrase:

Pass phrase is good.
blather-7.9-1.i386.rpm:
bother-3.5-1.i386.rpm:</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Build-time-Signing">Подпись во время сборки</h4>
<div class="paragraph">
<p>Чтобы подписать пакет во время сборки, используйте команду <code>rpmbuild</code> с параметром <code>--sign</code>. Для этого необходимо ввести кодовую фразу PGP.</p>
</div>
<div class="paragraph">
<p>Для примера:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmbuild -ba --sign blather-7.9.spec
            Enter pass phrase:

Pass phrase is good.
* Package: blather
…
Binary Packaging: blather-7.9-1
Finding dependencies...
…
Generating signature: 1002
Wrote: /usr/src/redhat/RPMS/i386/blather-7.9-1.i386.rpm
…
Source Packaging: blather-7.9-1
…
Generating signature: 1002
Wrote: /usr/src/redhat/SRPMS/blather-7.9-1.src.rpm</code></pre>
</div>
</div>
<div class="paragraph">
<p>Сообщение "Generating signature" появляется как в бинарном, так и в исходном разделах упаковки. Число, следующее за сообщением, указывает на то, что добавленная подпись была создана с использованием  PGP.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
<div class="paragraph">
<p>При использовании опции <code>--sign</code> в <code>rpmbuild</code>, используйте только аргументы <code>-bb</code> или <code>-ba</code> для сборки пакета. Аргумент <code>-ba</code> обозначает сборку бинарных <strong>и</strong> исходных пакетов.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Чтобы проверить подпись пакета, используйте команду <code>--checksig</code>. Для примера:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --checksig blather-7.9-1.i386.rpm
blather-7.9-1.i386.rpm: size pgp md5 OK</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="Building-Multiple-Packages">Сборка нескольких пакетов</h5>
<div class="paragraph">
<p>При сборке нескольких пакетов используйте следующий синтаксис, чтобы избежать многократного ввода кодовой фразы
PGP. Например, при сборке пакетов <code>blather</code> и <code>bother</code>, подпишите их, следуя примеру ниже:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmbuild -ba --sign b*.spec
              Enter pass phrase:

Pass phrase is good.
* Package: blather
…
Binary Packaging: blather-7.9-1
…
Generating signature: 1002
Wrote: /usr/src/redhat/RPMS/i386/blather-7.9-1.i386.rpm
…
Source Packaging: blather-7.9-1
…
Generating signature: 1002
Wrote: /usr/src/redhat/SRPMS/blather-7.9-1.src.rpm
…
* Package: bother
…
Binary Packaging: bother-3.5-1
…
Generating signature: 1002
Wrote: /usr/src/redhat/RPMS/i386/bother-3.5-1.i386.rpm
…
Source Packaging: bother-3.5-1
…
Generating signature: 1002
Wrote: /usr/src/redhat/SRPMS/bother-3.5-1.src.rpm</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="more-on-macros">Подробнее о макросах</h3>
<div class="paragraph">
<p>Существует множество встроенных макросов RPM, и мы рассмотрим некоторые из них в следующем разделе, однако исчерпывающий список можно найти на странице
<a href="https://rpm-software-management.github.io/rpm/manual/macros.html">RPM Official Documentation</a>.</p>
</div>
<div class="sect3">
<h4 id="defining-your-own">Определение Ваших Собственных Макросов</h4>
<div class="paragraph">
<p>Вы можете определить свои собственные макросы. Ниже приводится выдержка из
<a href="https://rpm-software-management.github.io/rpm/manual/macros.html">RPM Official Documentation</a>,  в которой содержится исчерпывающая информация о возможностях макросов.</p>
</div>
<div class="paragraph">
<p>Чтобы определить макрос, используйте:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%global &lt;name&gt;[(opts)] &lt;body&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Все пробелы, окружающие  <code>\ </code>, удаляются.  Имя может состоять из буквенно-цифровых символов и символа <code>_</code>,  и должно иметь длину не менее 3 символов. Макрос без поля <code>(opts)</code> является “простым” в том смысле, что выполняется только рекурсивное расширение макроса. Параметризованный макрос содержит поле <code>(opts)</code> field. The
<code>opts</code> - (строка в круглых скобках) передается точно так же, как и в getopt(3)  для обработки
argc/argv  в начале вызова макроса.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
<div class="paragraph">
<p>Более старый SPEC файлы RPM могут использовать шаблон макроса <code>%define &lt;name&gt; &lt;body&gt;</code>. Различия между макросами <code>%define</code> и <code>%global</code> заключаются в следующем:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>%define</code> имеет локальную область действия, что означает, что он применяется только к указанной части SPEC файла. Кроме того, тело макроса  <code>%define</code> расширяется при использовании.</p>
</li>
<li>
<p><code>%global</code> имеет глобальную область действия, что означает, что он применяется ко всему SPEC файлу.
Кроме того, тело макроса <code>%global</code> расширяется во время определения.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Пример:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>%global githash 0ec4e58
%global python_sitelib %(%{__python} -c "from distutils.sysconfig import get_python_lib; print(get_python_lib())")</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
Макросы всегда оцениваются, даже в комментариях. Иногда это безобидно. Но во втором примере мы выполняем команду python, чтобы получить содержимое макроса. Эта команда будет выполняться даже тогда, когда Вы закомментируете макрос, или когда Вы вводите имя макроса в %changelog. Чтобы закомментировать макрос, используйте
<code>%%</code>. Например: <code>%%global</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="setup">%setup</h4>
<div class="paragraph">
<p>Макрос  <code>%setup</code> можно использовать для сборки пакета с помощью tarball.
Стандартное поведение макроса <code>%setup</code> можно увидеть в выходных данных <code>rpmbuild</code>.
В начале каждой фазы макрос выводит <code>Executing(%something)</code>.
Например:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">Executing(%prep): /bin/sh -e /var/tmp/rpm-tmp.DhddsG</code></pre>
</div>
</div>
<div class="paragraph">
<p>Выходные данные оболочки устанавливаются с включенным <code>set -x</code>. Чтобы просмотреть содержимое
<code>/var/tmp/rpm-tmp.DhddsG</code>, используйте опцию <code>--debug</code>, поскольку <code>rpmbuild</code> удаляет временные файлы после успешной сборки. Здесь отображается настройка переменных среды, например:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd '/builddir/build/BUILD'
rm -rf 'cello-1.0'
/usr/bin/gzip -dc '/builddir/build/SOURCES/cello-1.0.tar.gz' | /usr/bin/tar -xof -
STATUS=$?
if [ $STATUS -ne 0 ]; then
  exit $STATUS
fi
cd 'cello-1.0'
/usr/bin/chmod -Rf a+rX,u+w,g-w,o-w .</code></pre>
</div>
</div>
<div class="paragraph">
<p>Макрос <code>%setup</code> гарантирует, что мы работаем в правильном каталоге, удаляет остатки предыдущих сборок, распаковывает исходный архив и устанавливает некоторые привилегии по умолчанию. Существует несколько вариантов настройки поведения макроса
<code>%setup</code>.</p>
</div>
<div class="sect4">
<h5 id="setup-q">%setup -q</h5>
<div class="paragraph">
<p>Параметр <code>-q</code>  ограничивает детализацию макроса  <code>%setup</code>. Вместо <code>tar -xof</code> выполняется только <code>tar -xvvof</code>. Этот параметр должен быть использован в качестве первого.</p>
</div>
</div>
<div class="sect4">
<h5 id="setup-n">%setup -n</h5>
<div class="paragraph">
<p>В некоторых случаях каталог из расширенного архива имеет другое имя, чем ожидалось <code>%{name}-%{version}</code>. Это может привести к ошибке макроса <code>%setup</code>.  Имя каталога должно быть указано параметром <code>-n directory_name</code>.</p>
</div>
<div class="paragraph">
<p>Например, если имя пакета  <code>cello</code>, но исходный код заархивирован в <code>hello-1.0.tgz</code> и содержит каталог <code>hello/</code>, содержимое SPEC файла должно быть следующим:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name: cello
Source0: https://example.com/%{name}/release/hello-%{version}.tar.gz
…
%prep
%setup -n hello</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="setup-c">%setup -c</h5>
<div class="paragraph">
<p>Параметр  <code>-c</code> можно использовать, если архив исходного кода не содержит никаких подкаталогов и после распаковки файлы из архива заполняют текущий каталог. Опция <code>-c</code> создает каталог и переходит к расширению архива. Наглядный пример:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/usr/bin/mkdir -p cello-1.0
cd 'cello-1.0'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Каталог не изменяется после расширения архива.</p>
</div>
</div>
<div class="sect4">
<h5 id="setup-dt">%setup -D и -T</h5>
<div class="paragraph">
<p>Параметр <code>-D</code>  отключает удаление каталога исходного кода. Этот параметр полезен, если макрос <code>%setup</code> используется несколько раз. По сути, параметр <code>-D</code> означает, что сделующие строки не используются:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">rm -rf 'cello-1.0'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Параметр<code>-T</code> отключает расширение хранилища исходного кода, удаляя следующую строку из скрипта:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/usr/bin/gzip -dc '/builddir/build/SOURCES/cello-1.0.tar.gz' | /usr/bin/tar -xvvof -</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="setup-ab">%setup -a и -b</h5>
<div class="paragraph">
<p>Параметры <code>-a</code> и <code>-b</code> расширяют определённые источники.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Параметр <code>-b</code> (расшифровывается как <code>before</code>) расширяет определенные источники перед входом в рабочий каталог.</p>
</li>
<li>
<p>Параметр <code>-a</code> (расшифровывается как  <code>after</code>) расширяет эти источники после входа. Их аргументами являются исходные номера из преамбулы файла спецификации.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Например, допустим, что архив <code>cello-1.0.tar.gz</code> содержит пустой каталог <code>examples</code>, и примеры поставляются в отдельных
<code>examples.tar.gz</code> tarball архивах, и они разархивируются в каталог с тем же именем. В этом случае используйте <code>-a 1</code>, так как мы хотим разархивировать <code>Source1</code> после входа в рабочий каталог:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Source0: https://example.com/%{name}/release/%{name}-%{version}.tar.gz
Source1: examples.tar.gz
…
%prep
%setup -a 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Но если бы примеры были в отдельном <code>cello-1.0-examples.tar.gz</code> tarball архиве, который расширяется до <code>cello-1.0/examples</code>, используйте параметры <code>-b 1</code>, поскольку <code>Source1</code> должен быть разархивирован перед входом в рабочий каталог:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Source0: https://example.com/%{name}/release/%{name}-%{version}.tar.gz
Source1: %{name}-%{version}-examples.tar.gz
…
%prep
%setup -b 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вы также можете использовать комбинацию всех этих опций.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="files">%files</h4>
<div class="paragraph">
<p>Общие  “расширенные” макросы RPM, необходимые в разделе <code>%files</code>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Макрос</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Описание</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%license</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Макрос идентифицирует файл, указанный в списке, как файл ЛИЦЕНЗИИ, и он будет установлен и помечен как таковой RPM. Пример: <code>%license LICENSE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%doc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Этот макрос идентифицирует файл, указанный как документация, и он будет установлен и помечен RPM как таковой. Это часто используется не только для документации об упаковываемом программном обеспечении, но и для примеров кода и различных элементов, которые должны сопровождать документацию. Пример: <code>%doc README</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%dir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Макрос указывает, что путь является каталогом, которым должен владеть этот RPM. Это важно, чтобы манифест RPM-файла точно знал, какие каталоги очищать при удалении. Пример: <code>%dir %{_libdir}/%{name}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Указывает, что следующий файл является файлом конфигурации и поэтому не должен перезаписываться (или заменяться) при установке или обновлении пакета, если файл был изменен по сравнению с исходной контрольной установкой. В случае внесения изменений файл будет создан с добавлением <code>.rpmnew</code> в конец имени файла при обновлении или установке, чтобы ранее существующий или измененный файл в целевой системе не был изменен. Пример: <code>%config(noreplace) %{_sysconfdir}/%{name}/%{name}.conf</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="built-in-macros">Встроенные макросы</h4>
<div class="paragraph">
<p>В Вашей системе есть много встроенных макросов RPM, и самый быстрый способ просмотреть их все - это просто выполнить команду <code>rpm --showrc</code>. Обратите внимание, что это будет содержать много выходных данных, поэтому его часто используют в сочетании с каналом для <code>grep</code>.</p>
</div>
<div class="paragraph">
<p>Вы также можете найти информацию о макросах RPM, которые поставляются непосредственно с версией RPM Вашей системы, просмотрев выходные данные   <code>rpm -ql rpm</code> , обратив внимание на файлы с названием <code>macros</code> в структуре каталогов.</p>
</div>
</div>
<div class="sect3">
<h4 id="rpm-distribution-macros">RPM Макросы, предоставляемые дистрибутивом</h4>
<div class="paragraph">
<p>Различные дистрибутивы будут предоставлять разные наборы рекомендуемых макросов RPM в зависимости от языковой реализации упаковываемого программного обеспечения или конкретных рекомендаций рассматриваемого дистрибутива. <a href="https://www.altlinux.org/Spec/Предопределенные_макросы">Предопределённые макросы</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom-macros">Пользовательские макросы</h3>
<div class="paragraph">
<p>Вы можете переопределить макросы в файле <code>~/.rpmmacros</code>. Любые внесенные вами изменения повлияют на каждую сборку на Вашем компьютере.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Существует несколько макросов, которые Вы можете использовать для переопределения</dt>
<dt class="hdlist1"><code>%_topdir /opt/some/working/directory/rpmbuild</code></dt>
<dd>
<p>Вы можете создать этот каталог, включая все подкаталоги, с помощью утилиты <code>rpmdev-setuptree</code>.
Значение этого макроса по умолчанию равно<code>~/rpmbuild</code>.</p>
</dd>
<dt class="hdlist1"><code>%_smp_mflags -l3</code></dt>
<dd>
<p>Этот макрос часто используется для передачи в Makefile, например:
<code>make %{?_smp_mflags}</code>, и для задания количества одновременных процессов на этапе сборки. По умолчанию для него задано значение <code>-jX</code>, где X - количество ядер. Если Вы измените количество ядер, Вы можете ускорить или замедлить сборку пакетов.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Хотя Вы можете определить любые новые макросы в файле <code>~/.rpmmacros</code>  это не рекомендуется, поскольку эти макросы не будут присутствовать на других компьютерах, где пользователи могут захотеть попытаться пересобрать Ваш пакет.</p>
</div>
</div>
<div class="sect2">
<h3 id="epoch-scriptlets-and-triggers">Epoch, Скриптлеты и Триггеры</h3>
<div class="paragraph">
<p>В мире SPEC файлов RPM существуют различные разделы, которые считаются продвинутыми, поскольку они влияют не только на файл спецификации, способ сборки пакета, но и на конечный компьютер, на который устанавливается результирующий RPM. В этом разделе мы рассмотрим наиболее распространенные из них, такие как Epoch, Скриптлеты и триггеры.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hasher_start">Hasher start</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_что_такое_hasher">Что такое hasher?</h3>
<div class="paragraph">
<p><strong>Hasher</strong> — это инструмент безопасной и воспроизводимой сборки пакетов. Все пакеты репозитория <a href="https://www.altlinux.org/Sisyphus"><code><strong><em>Сизиф</em></strong></code></a> собираются с его помощью.</p>
</div>
</div>
<div class="sect2">
<h3 id="_принцип_действия">Принцип действия</h3>
<div class="paragraph">
<p><strong><code>Hasher</code></strong> — инструмент для сборки пакетов в «чистой» и контролируемой среде. Это достигается с помощью создания в chroot минимальной сборочной среды, установки туда указанных в source-пакете сборочных зависимостей и сборке пакета в свежесозданной среде. Для сборки каждого пакета сборочная среда создаётся заново.</p>
</div>
<div class="paragraph">
<p>Такой принцип сборки имеет несколько следствий:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Все необходимые для сборки зависимости должны быть указаны в пакете. Для облегчения поддержки сборочных зависимостей в актуальном состоянии в <a href="https://www.altlinux.org/Sisyphus"><code><strong><em>Сизифе</em></strong></code></a> придуман инструмент под названием buildreq,</p>
</li>
<li>
<p>Сборка не зависит от конфигурации компьютера пользователя, собирающего пакет, и может быть повторена на другом компьютере,</p>
</li>
<li>
<p>Изолированность среды сборки позволяет с лёгкостью собирать на одном компьютере пакеты для разных дистрибутивов и веток репозитория — для этого достаточно лишь направить hasher на различные репозитории для каждого сборочного окружения.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_настройка_hasher">Настройка Hasher</h3>
<div class="paragraph">
<p>Установка Hasher:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># apt-get install hasher</code></pre>
</div>
</div>
<div class="paragraph">
<p>Добавление пользователя:</p>
</div>
<div class="paragraph">
<p>Hasher использует специальных вспомогательных пользователей и группу <code>hashman</code> для своей работы, поэтому каждого пользователя, желающего использовать <code>hasher</code>, перед началом работы нужно зарегистрировать:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># hasher-useradd USER</code></pre>
</div>
</div>
<div class="paragraph">
<p>Настройка сборочной среды:</p>
</div>
<div class="paragraph">
<p>Для работы <code>hasher</code> требуется создать директорию, в которой будет строиться сборочная среда:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mkdir ~/.hasher</code></pre>
</div>
</div>
<div class="paragraph">
<p>Рабочий каталог (в данном случае ~/.hasher) должен быть доступен на запись пользователю, запускающему сборку.</p>
</div>
<div class="paragraph">
<p>Кроме того, его нельзя располагать на файловой системе, которая смонтирована с опциями <code>noexec</code> или <code>nodev</code> — в таких условиях <code>hasher</code> не сможет создать корректное сборочное окружение.</p>
</div>
<div class="paragraph">
<p>Сборочное окружение можно создать явно:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ hsh --initroot-only ~/.hasher</code></pre>
</div>
</div>
<div class="paragraph">
<p>Явное создание необязательно — при необходимости оно будет произведено при первой сборке пакета.</p>
</div>
<div class="paragraph">
<p>Hasher берёт пакеты для установки из APT-источников. По умолчанию в сборочную среду копируется список источников, указанный в конфигурации APT хост-системы; также можно явно задать дополнительные репозитории, указав альтернативный файл конфигурации APT:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ hsh --apt-config=branch4.1-apt.conf --initroot-only ~/.hasher</code></pre>
</div>
</div>
<div class="paragraph">
<p>В таком файле конфигурации необходимо указать расположение файла с APT-источниками:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ hsh --apt-config=branch4.1-apt.conf --initroot-only ~/.hasher</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_сборка_в_hasher">Сборка в hasher</h3>
<div class="paragraph">
<p>Сборка происходит от обычного пользователя, добавленного с помощью hasher-useradd:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">hsh ~/.hasher /home/work/rpm/package.src.rpm</code></pre>
</div>
</div>
<div class="paragraph">
<p>При удачной сборке полученные пакеты будут лежать в <code><strong>~/.hasher/repo/&lt;платформа&gt;/RPMS.hasher/</strong></code>, в противном случае на stdout будет выведена информация об ошибках сборки.</p>
</div>
<div class="paragraph">
<p>Создаваемый hasher репозиторий является обычным APT-репозиторием и может быть использован в sources.list[3]. Также он будет использован при дальнейшей сборке пакетов (это поведение можно регулировать ключом --without-stuff).</p>
</div>
<div class="paragraph">
<p>Если вы держите сборочную среду в tmpfs (см. ниже), каталог ~/.hasher/repo, вероятно, не переживёт перезагрузку системы. Репозиторий можно переместить в постоянное место, указав в настроечном файле hasher .hasher/config параметр def_repo=постоянное_хранилище (или вызвав hasher с ключом --repo).</p>
</div>
</div>
<div class="sect2">
<h3 id="_сборочные_зависимости">Сборочные зависимости</h3>
<div class="paragraph">
<p>Сборочные зависимости RPM делятся на два вида:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>необходимые для корректного создания src.rpm из spec-файла (содержащие определения RPM-макросов, используемых в spec-файле),</p>
</li>
<li>
<p>все остальные (необходимые для непосредственной сборки).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Поскольку <code>hasher</code> собирает пакеты из src.rpm (не считая поддержки <code>gear</code>), то для сборки необходимо иметь в хост-системе установленные   сборочные зависимости первого типа. Большинство таких зависимостей (но пока не все) содержатся в пакетах с названием <code>rpm-build-*</code>.</p>
</div>
<div class="paragraph">
<p>Поскольку сборка src.rpm либо завершается неудачно (при отсутствии сборочной зависимости первого типа), либо корректно, то собирать src.rpm-пакеты в хост системе можно с помощью <code><strong>--nodeps</strong></code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">rpm -bs --nodeps package.spec</code></pre>
</div>
</div>
<div class="paragraph">
<p>Сам <code>hasher</code>, в отличие от <code>gear</code>, не предъявляет никаких требований к разделению сборочных зависимостей на первый и второй тип. Однако для совместимости с <code>gear</code> и для улучшения описания spec-файла рекомендуется распределять их так:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>В поле BuildRequires(pre) помещать сборочные зависимости, требуемые для сборки src.rpm,</p>
</li>
<li>
<p>В поле BuildRequires — все остальные.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Примечание</div>
</td>
<td class="content">
в поле BuildRequires(pre) нельзя использовать макросы.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_man_hasher">man hasher</h3>
<div class="paragraph">
<p>Для получение подробной справки и пояснении команд - воспользуйтесь мануалом <code>hasher</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ man hsh</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_монтирование_файловых_систем_внутри_hasher">Монтирование файловых систем внутри hasher</h3>
<div class="paragraph">
<p>Некоторым приложениям для сборки требуется смонтированная файловая система (например, /proc). hasher поддерживает монтирование дополнительных файловых систем в сборочную среду.</p>
</div>
<div class="paragraph">
<p>Монтирование происходит при одновременном выполнении следующих четырех условий:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>файловая система описана в файле <code><strong>/etc/hasher-priv/fstab</strong></code>, либо является одной из предопределённых: <code><strong>/proc</strong></code>, <code><strong>/dev/pts</strong></code>, <code><strong>/sys</strong></code>;
в конфигурации hasher-priv <code><strong>(/etc/hasher-priv/system)</strong></code> ФС указана в опции <code>allowed_mountpoints</code>;</p>
</li>
<li>
<p>файловая система указана в опции <code>--mountpoints</code> при запуске <code>hasher</code>, либо, аналогично, в ключе <code>known_mountpoints</code> конфигурационного файла hasher <code><strong>(~/.hasher/config)</strong></code>;</p>
</li>
<li>
<p>файловая система указана сборочной зависимостью <code><strong>(например, BuildReq: /proc)</strong></code> собираемого пакета, прямой или косвенной (через зависимости сборочных зависимостей пакета).</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-07-12 19:02:56 +0400
</div>
</div>
</body>
</html>